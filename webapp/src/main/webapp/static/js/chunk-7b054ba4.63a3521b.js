(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b054ba4"],{4026:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"metadata-management-page"},[a("div",{staticClass:"header-action-button"},[e.isLoading?a("span",{staticClass:"progress-info"},[e._v("(同步启动中...)")]):e._e(),e.isUpdating?a("span",{staticClass:"progress-info"},[e._v("(同步进度..."+e._s(e.updateInfo)+")")]):e._e(),e.isUpdateSuccess?a("span",{staticClass:"progress-info"},[e._v("(同步已完成"),a("gs-icon",{attrs:{name:"check-circle"}}),e._v(")")],1):e._e(),e.isUpdateError?a("span",{staticClass:"progress-info"},[e._v("\n      (同步发生错误..."+e._s(e.updateInfo)+"\n      "),a("gs-tooltip",{attrs:{title:e.updateError,placement:"left"}},[a("gs-icon",{attrs:{name:"exclamation-circle"}})],1),e._v("\n      )\n    ")],1):e._e(),a("gs-button",{staticClass:"supplement-data",attrs:{disabled:!!e.updateInfo&&!e.updateStatus,type:"primary"},on:{click:e.supplementData}},[e._v("\n      增量同步元数据\n    ")])],1),a("div",{staticClass:"content-header"},[a("bread-crumb",{attrs:{"current-level":"元数据管理"}},[a("div",{staticClass:"bread-crumb-metadata-header",attrs:{slot:"header"},slot:"header"},[e._v("\n        元数据管理\n        ")])])],1),a("div",{staticClass:"content-body"},[a("div",{staticClass:"filter-content"},[a("div",{staticClass:"filter"},[a("gs-checkbox",{model:{value:e.showAllTable,callback:function(t){e.showAllTable=t},expression:"showAllTable"}},[e._v("\n          显示所有表和库\n        ")])],1),a("div",{staticClass:"search-filter"},[a("gs-search",{attrs:{disabled:e.refreshCache,placeholder:"请输入搜索内容..."},on:{search:e.handleSearch},model:{value:e.filter.keyword,callback:function(t){e.$set(e.filter,"keyword",t)},expression:"filter.keyword"}},[a("template",{slot:"prepend"},[a("gs-select",{attrs:{disabled:e.refreshCache},model:{value:e.filter.type,callback:function(t){e.$set(e.filter,"type",t)},expression:"filter.type"}},e._l(e.options,function(e){return a("gs-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],2)],1),a("gs-button",{staticClass:"pull-right expand-all",attrs:{type:"text-primary"},on:{click:e.closeAll}},[e._v("\n        全部收起\n      ")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:0===e.showViewType,expression:"showViewType === 0"},{name:"loading",rawName:"v-loading",value:e.table.isLoading||e.refreshCache,expression:"table.isLoading || refreshCache"}],staticClass:"relative db-list"},[a("el-table",{ref:"table",attrs:{"row-class-name":e.getClassName,data:e.table.data,stripe:""},on:{"expand-change":e.expandChange}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.row.loading,expression:"props.row.loading"}],attrs:{"show-header":!1,"row-class-name":e.getClassName,data:t.row.tableList,stripe:""}},[a("el-table-column",{attrs:{prop:"filename",label:"数据名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"title",on:{click:function(a){return e.toDetail(t.row.tableId)}}},[a("i",{staticClass:"iconfont icon-biaoge icon-item"}),e._v("\n                    "+e._s(t.row.tableName)+"\n                  ")])]}}],null,!0)}),a("el-table-column",{attrs:{prop:"description",label:"描述","class-name":"expand-second-column","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",prop:"user",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("gs-button",{attrs:{type:"text-primary"},on:{click:function(a){return e.toDetail(t.row.tableId)}}},[e._v("\n                    详情\n                  ")])]}}],null,!0)})],1),t.row.tableList.length<t.row.sum?a("div",{staticClass:"text-center show-more"},[a("gs-button",{attrs:{loading:t.row.loading},on:{click:function(a){return e.showMore(t.row,t.$index)}}},[e._v("\n                点击加载更多\n              ")])],1):e._e()]}}])}),a("el-table-column",{attrs:{label:"数据名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("i",{staticClass:"iconfont icon-yuanshuju"}),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.databaseName))])]}}])}),a("el-table-column",{attrs:{label:"描述",prop:"databaseDescription","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"80"}},[[a("span",[e._v("-")])]],2)],1),a("gs-pagination",{directives:[{name:"show",rawName:"v-show",value:e.table.total>0,expression:"table.total>0"}],attrs:{current:e.table.currentPage,total:e.table.total,"page-size":e.table.pageSize,"page-sizes":e.table.pageSizes,layout:"range,total,pagesizes,pager,jumper,jumpbtn"},on:{"page-change":e.pageChange,"page-size-change":e.pageSizeChange}})],1),a("table-filter",{directives:[{name:"show",rawName:"v-show",value:1===e.showViewType,expression:"showViewType === 1"}],ref:"table-filter",attrs:{"show-all-table":e.showAllTable,"refresh-cache":e.refreshCache}}),a("field-filter",{directives:[{name:"show",rawName:"v-show",value:2===e.showViewType,expression:"showViewType === 2"}],ref:"field-filter",attrs:{"refresh-cache":e.refreshCache}})],1)])},s=[],n=(a("ac6a"),a("77c1"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"metadata-management-table-filter-page"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.table.isLoading||e.refreshCache,expression:"table.isLoading || refreshCache"}],staticClass:"relative"},[a("el-table",{ref:"table",attrs:{"row-class-name":e.getClassName,data:e.table.data,"row-style":e.getStyle}},[a("el-table-column",{attrs:{"class-name":"cell-filter-item"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("a",{on:{click:function(a){return e.toTableDetail(t.row.tableId)}}},[a("i",{staticClass:"iconfont icon-biaoge icon-item"}),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.tableName))])])]),a("div",[a("i",{staticClass:"iconfont icon-yuanshuju"}),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.databaseName))]),a("i",{staticClass:"gs-icon-down",style:{transform:"rotate(-90deg)"}}),a("i",{staticClass:"iconfont icon-biaoge icon-item"}),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.tableName))])])]}}])})],1),a("gs-pagination",{directives:[{name:"show",rawName:"v-show",value:e.table.total>0,expression:"table.total>0"}],attrs:{current:e.table.currentPage,total:e.table.total,"page-size":e.table.pageSize,"page-sizes":e.table.pageSizes,layout:"range,total,pagesizes,pager,jumper,jumpbtn"},on:{"page-change":e.pageChange,"page-size-change":e.pageSizeChange}})],1)])}),l=[],o=(a("5da7"),a("575b")),r={props:{refreshCache:{type:Boolean,default:!1},showAllTable:{type:Boolean,default:!1}},data:function(){return{searchText:this.searchText,table:{isLoading:!1,data:[],total:0,currentPage:1,pageSize:10,pageSizes:[10,20,30,40,50,100]}}},computed:{allTableVisible:function(){return this.showAllTable}},methods:{getClassName:function(e){var t=e.row;return"DELETED"===t.status?"delete-status":""},getStyle:function(e){var t=e.row;if(!this.allTableVisible&&("DELETED"===t.status||t.virtualTable))return{display:"none"}},toTableDetail:function(e){this.$router.push({path:"/main/metadata/detail/".concat(e)})},getListByTable:function(e,t){return this.searchText=e,this.getList(!t,t)},getList:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.table.isLoading=!0,e&&(this.table.currentPage=1);var a=this.searchText;return o["e"]({query:this.searchText,offset:(this.table.currentPage-1)*this.table.pageSize,limit:this.table.pageSize}).then(function(e){t.searchText===a&&(t.table.isLoading=!1,t.table.total=e.sum,t.table.data=e.lists)}).catch(function(e){t.table.isLoading=!1})},pageChange:function(e){this.table.currentPage=e,this.getList()},pageSizeChange:function(e){this.table.pageSize=e,this.table.currentPage=1,this.getList()}}},c=r,u=a("2877"),d=Object(u["a"])(c,n,l,!1,null,null,null),f=d.exports,h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"metadata-management-field-filter-page"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.table.isLoading||e.refreshCache,expression:"table.isLoading || refreshCache"}],staticClass:"relative"},[a("el-table",{ref:"table",attrs:{"row-class-name":e.getClassName,data:e.table.data}},[a("el-table-column",{attrs:{"class-name":"cell-filter-item"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("a",{on:{click:function(a){return e.toTableFieldDetail(t.row.tableId)}}},[a("i",{staticClass:"iconfont icon-ziduantubiao"}),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.columnName))])])]),a("div",[a("i",{staticClass:"iconfont icon-yuanshuju"}),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.databaseName))]),a("i",{staticClass:"gs-icon-down",style:{transform:"rotate(-90deg)"}}),a("i",{staticClass:"iconfont icon-biaoge icon-item"}),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.tableName))]),a("i",{staticClass:"gs-icon-down",style:{transform:"rotate(-90deg)"}}),a("i",{staticClass:"iconfont icon-ziduantubiao icon-item"}),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.columnName))])])]}}])})],1),a("gs-pagination",{directives:[{name:"show",rawName:"v-show",value:e.table.total>0,expression:"table.total>0"}],attrs:{current:e.table.currentPage,total:e.table.total,"page-size":e.table.pageSize,"page-sizes":e.table.pageSizes,layout:"range,total,pagesizes,pager,jumper,jumpbtn"},on:{"page-change":e.pageChange,"page-size-change":e.pageSizeChange}})],1)])},p=[],g={props:{refreshCache:{type:Boolean,default:!1}},data:function(){return{searchText:null,table:{isLoading:!1,data:[],total:0,currentPage:1,pageSize:10,pageSizes:[10,20,30,40,50,100]}}},mounted:function(){},methods:{getClassName:function(e){var t=e.row;return"DELETED"===t.status?"delete-status":""},toTableFieldDetail:function(e){this.$router.push({path:"/main/metadata/detail/".concat(e),query:{module:"field"}})},getListByField:function(e,t){return this.searchText=e,this.getList(!t,t)},getList:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.table.isLoading=!0,e&&(this.table.currentPage=1);var a=this.searchText;return o["b"]({query:this.searchText,offset:(this.table.currentPage-1)*this.table.pageSize,limit:this.table.pageSize}).then(function(e){t.searchText===a&&(t.table.isLoading=!1,t.table.total=e.sum,t.table.data=e.lists)}).catch(function(e){t.table.isLoading=!1})},pageChange:function(e){this.table.currentPage=e,this.getList()},pageSizeChange:function(e){this.table.pageSize=e,this.table.currentPage=1,this.getList()}}},b=g,m=Object(u["a"])(b,h,p,!1,null,null,null),v=m.exports,w=a("acc6"),y=a("fbcf"),C=a("5118"),_=10,T=!1,S={name:"MetadataManagement",components:{TableFilter:f,FieldFilter:v,BreadCrumb:w["a"]},data:function(){return{refreshCache:!1,showViewType:0,filter:{keyword:"",type:0},options:[{value:0,label:"库"},{value:1,label:"表"},{value:2,label:"字段"}],table:{isLoading:!1,data:[],total:0,currentPage:1,pageSize:10,pageSizes:[10,20,30,40,50,100]},showAllTable:!0,job:null,updateStatus:"",updateError:"",updateInfo:"",updatePercent:0,isLoading:!1}},computed:{isUpdating:function(){var e=this.updateInfo,t=this.updateStatus,a=this.isLoading;return e&&"error"!==t&&"success"!==t&&!a},isUpdateError:function(){return"error"===this.updateStatus},isUpdateSuccess:function(){return"success"===this.updateStatus}},beforeRouteEnter:function(e,t,a){T=e.meta.keepAlive,a()},beforeRouteLeave:function(e,t,a){t.meta.keepAlive=!1,Object(C["clearTimeout"])(this.job),a()},activated:function(){!1===T&&(this.showViewType=0,this.filter.keyword="",this.filter.type=0,this.table.data=[],this.table.total=0,this.table.currentPage=1,this.table.pageSize=10,this.init())},mounted:function(){this.init()},methods:{init:function(){this.getMetaList(!0),this.getProgress()},supplementData:function(){var e=this;this.$Modal.confirm({title:"提示",content:"增量同步元数据需要花费较长时间，确认开始同步吗？",onOk:function(){o["j"]().then(function(t){e.getProgress()})}})},getProgress:function(){var e=this;function t(){o["f"]().then(function(a){var i=a.total,s=a.updated,n=a.error,l=a.startTime;if(i||l)if(n)e.isLoading=!1,e.updateStatus="error",e.updateError=n,Object(C["clearTimeout"])(e.job);else{var o=s/i*100,r=parseFloat(o.toFixed(1));e.updatePercent=r,e.updateInfo=s+"/"+i,100===o?(e.isLoading=!1,e.updateStatus="success",Object(C["clearTimeout"])(e.job)):i||(e.isLoading=!0,e.updateStatus="",e.job=Object(C["setTimeout"])(t,1e4))}else e.updateInfo=""})}e.job=Object(C["setTimeout"])(t,0)},getClassName:function(e){var t=e.row;return"DELETED"===t.status?this.showAllTable?"delete-status":"hide-row":""},closeAll:function(){var e=this;this.table.data.forEach(function(t){e.$refs["table"].toggleRowExpansion(t,!1)})},toCreateView:function(){this.$router.push({path:"/main/metadata/create"})},toDetail:function(e){this.$router.push({path:"/main/metadata/detail/".concat(e)})},handleExpandShow:function(){var e=this;this.$nextTick(function(){if(e.$refs["table"]){var t=[].slice.call(e.$refs["table"].$el.querySelectorAll(".el-table__row"));e.table.data.forEach(function(e,a){e.tableList.length?t[a].querySelector(".el-table__expand-column .cell").style.visibility="visible":t[a].querySelector(".el-table__expand-column .cell").style.visibility="hidden"})}})},refreshData:function(){var e=this;this.refreshCache||(this.refreshCache=!0,y["a"]().then(function(t){e.handleSearch()}).catch(function(t){e.refreshCache=!1}))},handleSearch:function(){var e=this;switch(this.filter.type){case 0:this.showViewType=0,this.getMetaList(!this.refreshCache,this.refreshCache).then(function(t){e.refreshCache=!1});break;case 1:this.showViewType=1,this.$nextTick(function(){e.$refs["table-filter"].getListByTable(e.filter.keyword,e.refreshCache).then(function(t){e.refreshCache=!1})});break;case 2:this.showViewType=2,this.$nextTick(function(){e.$refs["field-filter"].getListByField(e.filter.keyword,e.refreshCache).then(function(t){e.refreshCache=!1})});break}},getMetaList:function(e,t){var a=this;this.table.isLoading=!0,e&&(this.table.currentPage=1);var i=this.filter.keyword;return o["d"]({query:this.filter.keyword,offset:(this.table.currentPage-1)*this.table.pageSize,limit:this.table.pageSize}).then(function(e){a.filter.keyword===i&&(a.table.isLoading=!1,a.table.total=e.sum,e.lists.forEach(function(e){e.tableList=[]}),a.table.data=e.lists.map(function(e){return e.tableList=[],e.loading=!1,e}))}).catch(function(e){a.table.isLoading=!1})},showMore:function(e,t){e.loading=!0,o["i"]({databaseId:e.databaseId,offset:e.offset+_,limit:10}).then(function(t){e.tableList=e.tableList.concat(t.lists),e.offset=t.offset,e.count=t.count,e.sum=t.sum,e.loading=!1})},pageChange:function(e){this.table.currentPage=e,this.getMetaList()},pageSizeChange:function(e){this.table.pageSize=e,this.table.currentPage=1,this.getMetaList()},expandChange:function(e,t){e.tableList&&e.tableList.length||(e.loading=!0,o["i"]({databaseId:e.databaseId,offset:0,limit:10}).then(function(t){e.tableList=t.lists,e.offset=t.offset,e.count=t.count,e.sum=t.sum,e.loading=!1}))}}},L=S,k=Object(u["a"])(L,i,s,!1,null,null,null);t["default"]=k.exports},5118:function(e,t,a){(function(e){var i="undefined"!==typeof e&&e||"undefined"!==typeof self&&self||window,s=Function.prototype.apply;function n(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new n(s.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new n(s.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},a("6017"),t.setImmediate="undefined"!==typeof self&&self.setImmediate||"undefined"!==typeof e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!==typeof self&&self.clearImmediate||"undefined"!==typeof e&&e.clearImmediate||this&&this.clearImmediate}).call(this,a("c8ba"))},"5da7":function(e,t,a){},6017:function(e,t,a){(function(e,t){(function(e,a){"use strict";if(!e.setImmediate){var i,s=1,n={},l=!1,o=e.document,r=Object.getPrototypeOf&&Object.getPrototypeOf(e);r=r&&r.setTimeout?r:e,"[object process]"==={}.toString.call(e.process)?h():p()?g():e.MessageChannel?b():o&&"onreadystatechange"in o.createElement("script")?m():v(),r.setImmediate=c,r.clearImmediate=u}function c(e){"function"!==typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),a=0;a<t.length;a++)t[a]=arguments[a+1];var l={callback:e,args:t};return n[s]=l,i(s),s++}function u(e){delete n[e]}function d(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(a,i);break}}function f(e){if(l)setTimeout(f,0,e);else{var t=n[e];if(t){l=!0;try{d(t)}finally{u(e),l=!1}}}}function h(){i=function(e){t.nextTick(function(){f(e)})}}function p(){if(e.postMessage&&!e.importScripts){var t=!0,a=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=a,t}}function g(){var t="setImmediate$"+Math.random()+"$",a=function(a){a.source===e&&"string"===typeof a.data&&0===a.data.indexOf(t)&&f(+a.data.slice(t.length))};e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),i=function(a){e.postMessage(t+a,"*")}}function b(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;f(t)},i=function(t){e.port2.postMessage(t)}}function m(){var e=o.documentElement;i=function(t){var a=o.createElement("script");a.onreadystatechange=function(){f(t),a.onreadystatechange=null,e.removeChild(a),a=null},e.appendChild(a)}}function v(){i=function(e){setTimeout(f,0,e)}}})("undefined"===typeof self?"undefined"===typeof e?this:e:self)}).call(this,a("c8ba"),a("f28c"))},"77c1":function(e,t,a){},acc6:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return!e.upperLevel||e.isHideNav?a("div",{staticClass:"content-header-single"},[e._t("header",[e._v("\n    "+e._s(e.currentLevel)+"\n  ")])],2):a("div",{staticClass:"content-header-both"},[a("div",{staticClass:"back-link"},[a("router-link",{attrs:{to:e.backPath}},[a("gs-button",{staticClass:"back-btn",attrs:{type:"primary"},on:{click:e.backBtnClick}},[a("i",{staticClass:"gs-icon gs-icon-revoke"})])],1)],1),a("div",{staticClass:"nav-name"},[a("div",{staticClass:"current-nav"},[e._v("\n      "+e._s(e.currentLevel)+"\n    ")]),a("div",{staticClass:"upper-nav"},[e._v("\n      "+e._s(e.upperLevel)+"\n    ")])])])},s=[],n={name:"BreadCrumb",props:{currentLevel:{type:String,required:!0},upperLevel:{type:String,default:""},backPath:{type:String,default:""}},data:function(){return{}},computed:{isHideNav:function(){return!!this.$router.currentRoute.query.nav}},methods:{backBtnClick:function(){this.$emit("back")}}},l=n,o=a("2877"),r=Object(o["a"])(l,i,s,!1,null,null,null),c=r.exports;a("d12e"),t["a"]=c},d12e:function(e,t,a){}}]);
//# sourceMappingURL=chunk-7b054ba4.63a3521b.js.map