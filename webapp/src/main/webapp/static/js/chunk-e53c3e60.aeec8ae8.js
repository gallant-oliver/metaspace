(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e53c3e60"],{"0a49":function(e,t,i){var n=i("9b43"),s=i("626a"),r=i("4bf8"),a=i("9def"),o=i("cd1c");e.exports=function(e,t){var i=1==e,l=2==e,c=3==e,u=4==e,d=6==e,h=5==e||d,p=t||o;return function(t,o,g){for(var f,m,v=r(t),b=s(v),C=n(o,g,3),y=a(b.length),w=0,I=i?p(t,y):l?p(t,0):void 0;y>w;w++)if((h||w in b)&&(f=b[w],m=C(f,w,v),e))if(i)I[w]=m;else if(m)switch(e){case 3:return!0;case 5:return f;case 6:return w;case 2:I.push(f)}else if(u)return!1;return d?-1:c||u?u:I}}},1169:function(e,t,i){var n=i("2d95");e.exports=Array.isArray||function(e){return"Array"==n(e)}},"138d":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"data-list"},[i("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataTable",on:{"sort-change":e.sortChange,"selection-change":e.handleSelectionChange}},"el-table",e.tableProps,!1),[e._t("default")],2),i("gs-pagination",e._b({attrs:{"page-sizes":[10,20,30,40,50,100],layout:e.paginationProps.layout||"range,total,pagesizes,pager,jumper,jumpbtn"},on:{"page-change":e.pageChange,"page-size-change":e.pageSizeChange}},"gs-pagination",e.paginationProps,!1))],1)},s=[],r={props:{tableProps:{type:Object,default:function(){return{}}},paginationProps:{type:Object,default:function(){return{}}},loading:{type:Boolean,default:!1}},methods:{sortChange:function(e){var t=e.column,i=e.prop,n=e.order;this.$emit("sort-change",{column:t,prop:i,order:n})},handleSelectionChange:function(e){this.$emit("selection-change",e)},pageChange:function(e){this.$emit("page-change",e)},pageSizeChange:function(e){this.$emit("page-size-change",e)},clearSelection:function(){this.$refs.dataTable.clearSelection()},getTable:function(){return this.$refs.dataTable},doLayout:function(){this.$refs.dataTable.doLayout()}}},a=r,o=i("2877"),l=Object(o["a"])(a,n,s,!1,null,null,null),c=l.exports;t["a"]=c},"20d6":function(e,t,i){"use strict";var n=i("5ca1"),s=i("0a49")(6),r="findIndex",a=!0;r in[]&&Array(1)[r](function(){a=!1}),n(n.P+n.F*a,"Array",{findIndex:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}}),i("9c6c")(r)},"2b0b":function(e,t,i){"use strict";i.d(t,"f",function(){return s}),i.d(t,"b",function(){return r}),i.d(t,"e",function(){return a}),i.d(t,"d",function(){return o}),i.d(t,"a",function(){return l}),i.d(t,"c",function(){return c}),i.d(t,"g",function(){return u});var n=i("751a");function s(e){return n["a"].post("/privilege/privileges",e)}function r(e){return n["a"].delete("/privilege/".concat(e))}function a(e){return n["a"].get("/privilege/".concat(e))}function o(){return n["a"].get("/privilege/modules")}function l(e){return n["a"].post("/privilege",e)}function c(e,t){return n["a"].put("/privilege/".concat(e),t)}function u(e){return n["a"].post("/privilege/roles",e)}},7263:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"role-detail"},[i("gs-tabs",{attrs:{type:"content-tab"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("gs-tab-pane",{attrs:{label:"成员",name:"member"}},[i("member")],1),i("gs-tab-pane",{attrs:{label:"权限",name:"authorize"}},[i("authorize")],1)],1)],1)},s=[],r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"authorize"},[i("div",{staticClass:"header"},[i("div",{staticClass:"title"},[i("span",{staticClass:"label"},[e._v("权限方案:")]),e.edit?i("gs-select",{staticClass:"doc-select",attrs:{"popper-class":"searchable-select"},on:{change:e.changePrivilegeOption},model:{value:e.privilegeId,callback:function(t){e.privilegeId=t},expression:"privilegeId"}},e._l(e.privilegesOptions,function(e){return i("gs-option",{key:e.privilegeId,attrs:{label:e.privilegeName,value:e.privilegeId}})}),1):i("span",[e._v(e._s(e.privilege.privilegeName))])],1),i("div",{staticClass:"operation-box"},[i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.allowEdit&&!e.edit,expression:"allowEdit && !edit"}],attrs:{type:"text-primary"},on:{click:e.editPrivilege}},[e._v("\n        编辑\n      ")]),i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}],attrs:{type:"text-primary"},on:{click:e.changePrivilege}},[e._v("\n        确定\n      ")]),i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}],attrs:{type:"text-primary"},on:{click:e.cancel}},[e._v("\n        取消\n      ")])],1)]),i("div",{staticClass:"wrap"},[i("div",{staticClass:"left"},[i("div",{staticClass:"authorize-module"},[i("div",{staticClass:"title"},[e._v("\n          授权模块\n        ")]),e._l(e.privilege.modules.filter(function(e){return e.type})||[],function(t){return i("p",{key:t.moduleId},[i("i",{staticClass:"gs-icon-check"}),e._v(e._s(t.moduleName)+"\n        ")])})],2),i("div",{staticClass:"business-obj-ope"},[i("div",{staticClass:"title"},[e._v("\n          管理权限\n        ")]),e._l(e.privilege.modules.filter(function(e){return!e.type})||[],function(t){return i("p",{key:t.moduleId},[i("i",{staticClass:"gs-icon-check"}),e._v(e._s(t.moduleName)+"\n        ")])})],2)]),i("div",{staticClass:"right"},[i("div",{staticClass:"title"},[e._v("\n        授权范围\n      ")]),i("div",{staticClass:"wrapper"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.privilege.modules.some(function(e){return 1===e.moduleId}),expression:"privilege.modules.some(item =>item.moduleId === 1)"}],staticClass:"technical"},[i("div",{staticClass:"sub-title"},[e._v("\n            技术目录\n          ")]),i("gs-tree",{ref:"technicalTree",attrs:{data:e.technicalCategories,props:{label:"name",className:"hide"},"render-content":e.renderTree,"node-key":"guid"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:e.privilege.modules.some(function(e){return[2,5].includes(e.moduleId)}),expression:"privilege.modules.some(item => [2, 5].includes(item.moduleId))"}],staticClass:"bussiness"},[i("div",{staticClass:"sub-title"},[e._v("\n            业务目录\n          ")]),i("gs-tree",{ref:"businessTree",attrs:{data:e.businessCategories,props:{label:"name"},"render-content":e.renderTree,"node-key":"guid"}})],1)])])])])},a=[],o=i("75fc"),l=(i("7f7f"),i("ed08")),c=i("b369"),u=i("2b0b"),d={data:function(){return{privilege:{privilegeName:"",modules:[]},storePrivilege:{},roleId:"",technicalCategories:[],businessCategories:[],edit:!1,privilegesOptions:[],privilegeId:"",businessCheck:[],technicalCheck:[],loading:!1,allowEdit:!1}},created:function(){this.roleId=this.$route.params.id,this.fetchRolePrivilege()},methods:{fetchRolePrivilege:function(){var e=this;this.loading=!0,c["j"]({limit:-1,query:""}).then(function(t){e.privilegesOptions=t.lists}),c["l"](this.roleId).then(function(t){if(e.allowEdit=!!t.edit,t.technicalCategories&&t.technicalCategories.length){t.technicalCategories.map(function(t){return t.disabled=!t.show,t.status&&e.technicalCheck.push(t.guid),t});var i=Object(l["e"])(t.technicalCategories,"guid","parentCategoryGuid"),n=Object(l["f"])(i,"guid","upBrotherCategoryGuid","downBrotherCategoryGuid");e.technicalCategories=Object(l["d"])(n,!0,"hide",!1)}if(t.businessCategories&&t.businessCategories.length){t.businessCategories.map(function(t){return t.disabled=!t.show,t.status&&e.businessCheck.push(t.guid),t});var s=Object(l["e"])(t.businessCategories,"guid","parentCategoryGuid"),r=Object(l["f"])(s,"guid","upBrotherCategoryGuid","downBrotherCategoryGuid");e.businessCategories=Object(l["d"])(r,!0,"hide",!1)}e.privilegeId=t.privilege.privilegeId,e.privilege=t.privilege,e.storePrivilege=JSON.parse(JSON.stringify(t.privilege)),e.loading=!1})},renderTree:function(e,t){t.node;var i=t.data,n=this.edit;return i.hide?e("div"):e("span",[n?e("gs-checkbox",{attrs:{value:!!i.status,disabled:!i.show},on:{change:this.categoryChange.bind(this,i)}}):i.status?e("i",{class:"gs-icon-check"}):null,e("span",[i.name])])},filterNode:function(e){function t(e){return e=e.filter(function(e){return e.children&&(e.children=t(e.children)),!e.hide}),e}return t(e)},categoryChange:function(e){var t=function e(t,i){t.children&&t.children.map(function(t){return t.children?(t.status=i,e(t,i)):(t.status=i,t)})};e.status=1===e.status?0:1,t(e,e.status)},changePrivilege:function(){var e=this,t={};t.privilege={privilegeId:this.privilegeId,modules:this.privilege.modules};var i=function(e){function t(e){var i=function(e){var t;return(t=[]).concat.apply(t,Object(o["a"])(e))};return i(e.map(function(e){return Array.isArray(e.children)&&0===e.status?[e].concat(Object(o["a"])(t(e.children))):e}))}return t(e).filter(function(e){return 1===e.status}).map(function(e){return e.guid})},n=i(this.technicalCategories),s=i(this.businessCategories);n&&n.length&&(t.technicalCategories=n.map(function(e){return{guid:e,status:1}})),s&&s.length&&(t.businessCategories=s.map(function(e){return{guid:e,status:1}})),c["c"]({params:t,roleId:this.roleId}).then(function(t){e.edit=!1,e.$Message.success("修改成功"),e.fetchRolePrivilege()})},changePrivilegeOption:function(e){var t=this;u["e"](e).then(function(e){t.privilege.modules=e.modules})},cancel:function(){this.edit=!1,this.privilege=JSON.parse(JSON.stringify(this.storePrivilege)),this.privilegeId=this.privilege.privilegeId,this.technicalCategories=JSON.parse(this.copyTechnicalTree),this.businessCategories=JSON.parse(this.copyBusinessTree)},editPrivilege:function(){this.edit=!0,this.copyTechnicalTree=JSON.stringify(this.technicalCategories),this.copyBusinessTree=JSON.stringify(this.businessCategories)}}},h=d,p=i("2877"),g=Object(p["a"])(h,r,a,!1,null,null,null),f=g.exports,m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"member"},[i("div",{staticClass:"search-box",style:e.showAddMember?"":"justify-content: flex-end;"},[e.showAddMember?i("add-member",{attrs:{"role-id":e.roleId},on:{removeMember:e.removeMember,addMember:e.addMember}}):e._e(),i("gs-search",{attrs:{placeholder:"请输入用户名或帐号"},on:{clear:function(t){return e.fetchMemberList(1)},search:e.fetchMemberList},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),i("data-table",{attrs:{loading:e.loading,"table-props":{data:e.tableData},"pagination-props":e.pagination},on:{"page-change":e.pageChange,"page-size-change":e.sizeChange,"selection-change":e.selectionChange}},[e.showAddMember?i("el-table-column",{attrs:{type:"selection",fixed:""}}):e._e(),i("el-table-column",{attrs:{prop:"account",label:"帐号","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"username",label:"用户名","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"roleName",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.roles,function(t){return i("gs-tag",{key:t},[e._v("\n          "+e._s(t)+"\n        ")])})}}])})],1)],1)},v=[],b=(i("e98a"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("gs-button",{attrs:{type:"primary"},on:{click:e.openAddMemberModal}},[e._v("\n    添加成员\n  ")]),i("gs-button",{attrs:{type:"primary"},on:{click:e.removeMember}},[e._v("\n    移除成员\n  ")]),i("gs-modal",{attrs:{title:"添加成员",width:"680px"},on:{"visible-change":e.visibleChange,confirm:e.addMember},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[i("div",{staticClass:"add-member-wapper"},[i("div",{staticClass:"member-search-list"},[i("div",{staticClass:"header"},[e._v("\n          选项\n        ")]),i("gs-search",{staticClass:"search",on:{search:e.handleSearch,clear:e.handleSearch},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[i("template",{slot:"prepend"},[i("gs-select",{on:{change:e.roleChange},model:{value:e.roleFilter,callback:function(t){e.roleFilter=t},expression:"roleFilter"}},e._l(e.roleOptions,function(e){return i("gs-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId,title:e.roleName}})}),1)],1)],2),i("ul",{staticClass:"search-list"},e._l(e.memberOptions,function(t,n){return i("li",{key:n,staticClass:"list-item",style:t.isActive?"color:#0073e8;":"",on:{click:function(i){return e.doSelectItem(t,n)}}},[i("span",{staticClass:"label",attrs:{title:t.username}},[e._v(e._s(t.username)+"\n            ")]),t.roleName?i("span",{staticClass:"account",attrs:{title:t.roleName}},[e._v("\n              ("+e._s(t.roleName)+")\n            ")]):e._e()])}),0)],1),i("div",{staticClass:"member-select-list"},[i("div",{staticClass:"header"},[i("span",{staticClass:"header-left"},[e._v("\n            已选择\n          ")]),i("span",{staticClass:"header-right"},[e._v("\n            已选中 "+e._s(e.selectItemList.length)+" 项\n          ")])]),i("ul",{staticClass:"selected-list"},e._l(e.selectItemList,function(t,n){return i("li",{key:n,staticClass:"list-item"},[i("span",{staticClass:"label",attrs:{title:t.username}},[e._v(e._s(t.username)+"\n            ")]),t.account?i("span",{staticClass:"account",attrs:{title:t.account}},[e._v("\n              ("+e._s(t.account)+")\n            ")]):e._e(),i("i",{staticClass:"gs-icon-close",on:{click:function(i){return e.unselectOption(t)}}})])}),0)])]),i("gs-loading",{attrs:{"is-show":e.loading}})],1)],1)}),C=[],y=(i("7514"),i("20d6"),i("6762"),i("2fdb"),i("ac6a"),{props:{roleId:{type:String,required:!0,default:""}},data:function(){return{visible:!1,roleOptions:[],roleFilter:"all",memberOptions:[],keyword:"",selected:[],selectItemList:[],loading:!1}},watch:{memberOptions:function(e){var t=this;e.forEach(function(e){t.selected.includes(e.userId)&&(e.isActive=!0)})}},methods:{openAddMemberModal:function(){this.visible=!0},doSelectItem:function(e,t){if(this.memberOptions[t]["isActive"]=!this.memberOptions[t]["isActive"],this.memberOptions[t]["isActive"])this.selected.push(e.userId),this.selectItemList.push(e);else{var i=this.selected.findIndex(function(t){return t===e.userId});this.selected.splice(i,1),this.selectItemList.splice(i,1)}},removeMember:function(){this.$emit("removeMember")},visibleChange:function(e){var t=this;e&&(this.loading=!0,this.roleFilter="all",c["k"]({limit:-1,query:""}).then(function(e){e.lists=[{roleName:"全部",roleId:"all"}].concat(Object(o["a"])(e.lists));var i=e.lists.findIndex(function(e){return e.roleId===t.roleId});-1!==i&&e.lists.splice(i,1),t.roleOptions=e.lists.filter(function(e){return"1"!==e.roleId})}),c["h"](this.roleId,{limit:-1,query:this.keyword}).then(function(e){t.memberOptions=e.lists,t.loading=!1}))},addMember:function(){this.selected&&this.selected.length?(this.$emit("addMember",this.selected),this.visible=!1):this.$Message.warning("请选择成员")},handleSearch:function(){var e=this;"all"===this.roleFilter?c["h"](this.roleId,{limit:-1,query:this.keyword}).then(function(t){e.memberOptions=t.lists}):c["i"](this.roleFilter,{limit:-1,query:this.keyword}).then(function(t){e.memberOptions=t.lists})},roleChange:function(){var e=this;this.keyword="","all"===this.roleFilter?c["h"](this.roleId,{limit:-1,query:""}).then(function(t){e.memberOptions=t.lists}):c["i"](this.roleFilter,{limit:-1,query:""}).then(function(t){e.memberOptions=t.lists})},rightSelectedRender:function(e,t){var i=this.memberOptions.find(function(e){return t.value===e.userId});return e("div",{class:"right-slected"},[e("span",{class:"label",attrs:{title:i.username}},[i.username]),i.account?e("span",{class:"account",attrs:{title:i.account}},["(",i.account,")"]):null,e("i",{class:"gs-icon-close",on:{click:this.unselectOption.bind(this,t)}})])},unselectOption:function(e){var t=this.selected.findIndex(function(t){return t===e.userId});this.selected.splice(t,1),this.selectItemList.splice(t,1),this.memberOptions.forEach(function(t){t.userId===e.userId&&(t.isActive=!1)})}}}),w=y,I=Object(p["a"])(w,b,C,!1,null,null,null),_=I.exports,k=i("138d"),O={components:{addMember:_,dataTable:k["a"]},data:function(){var e=window.systemConfigs["SHOW_ROLE_ADD_BTN"];return{keyword:"",tableData:[],pagination:{total:0,pageSize:10,pageSizes:[10,20,30],current:1},loading:!1,showAddMember:e,selection:[],roleId:""}},computed:{},created:function(){this.roleId=this.$route.params.id,this.fetchMemberList(1)},methods:{fetchMemberList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;1===t&&(this.pagination.current=1),this.loading=!0,c["i"](this.roleId,{offset:(this.pagination.current-1)*this.pagination.pageSize,limit:this.pagination.pageSize,query:this.keyword}).then(function(t){t.lists.map(function(e){return e.roles=[e.roleName],e}),e.tableData=t.lists,e.pagination.total=t.sum||0,e.loading=!1}).catch(function(t){e.loading=!1})},pageChange:function(e){this.pagination.current=e,this.fetchMemberList()},sizeChange:function(e){this.pagination.pageSize=e,this.fetchMemberList(1)},removeMember:function(){var e=this;if(this.selection.length){var t=this.selection.map(function(e){return e.userId});this.$Modal.confirm({title:"警告",content:"是否删除该成员？删除后将无法恢复",onOk:function(){c["e"](e.roleId,t).then(function(t){e.$Message.success("删除成员成功"),e.fetchMemberList()})}})}else this.$Message.warning("请选择成员")},selectionChange:function(e){this.selection=e},addMember:function(e){var t=this;c["a"](this.roleId,e).then(function(e){t.$Message.success("添加成员成功"),t.fetchMemberList(1)})}}},x=O,M=Object(p["a"])(x,m,v,!1,null,null,null),N=M.exports,S={components:{authorize:f,member:N},data:function(){return{activeName:"member"}}},A=S,j=Object(p["a"])(A,n,s,!1,null,null,null);t["default"]=j.exports},7514:function(e,t,i){"use strict";var n=i("5ca1"),s=i("0a49")(5),r="find",a=!0;r in[]&&Array(1)[r](function(){a=!1}),n(n.P+n.F*a,"Array",{find:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}}),i("9c6c")(r)},b369:function(e,t,i){"use strict";i.d(t,"k",function(){return s}),i.d(t,"f",function(){return r}),i.d(t,"j",function(){return a}),i.d(t,"b",function(){return o}),i.d(t,"g",function(){return l}),i.d(t,"i",function(){return c}),i.d(t,"e",function(){return u}),i.d(t,"a",function(){return d}),i.d(t,"l",function(){return h}),i.d(t,"c",function(){return p}),i.d(t,"d",function(){return g}),i.d(t,"h",function(){return f});var n=i("751a");function s(e){return n["a"].post("/role/roles",e)}function r(e){return n["a"].delete("/role/".concat(e))}function a(e){return n["a"].post("/role/privileges",e)}function o(e){return n["a"].post("/role",e)}function l(e){var t=e.params,i=e.roleId;return n["a"].put("/role/".concat(i),t)}function c(e,t){return n["a"].post("/role/".concat(e,"/users"),t)}function u(e,t){return n["a"].delete("/role/".concat(e,"/user"),{data:t})}function d(e,t){return n["a"].post("role/".concat(e,"/user"),t)}function h(e){return n["a"].get("/role/".concat(e,"/privileges"))}function p(e){var t=e.params,i=e.roleId;return n["a"].put("/role/".concat(i,"/privileges"),t)}function g(e){var t=e.roleId,i=e.status;return n["a"].put("/role/".concat(t,"/").concat(i))}function f(e,t){return n["a"].post("/role/users/".concat(e),t)}},cd1c:function(e,t,i){var n=i("e853");e.exports=function(e,t){return new(n(e))(t)}},e853:function(e,t,i){var n=i("d3f4"),s=i("1169"),r=i("2b4c")("species");e.exports=function(e){var t;return s(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!s(t.prototype)||(t=void 0),n(t)&&(t=t[r],null===t&&(t=void 0))),void 0===t?Array:t}},e98a:function(e,t,i){}}]);
//# sourceMappingURL=chunk-e53c3e60.aeec8ae8.js.map