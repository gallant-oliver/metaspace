webpackJsonp([15],{1019:function(e,t){},1290:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(1291),i=a(1299),n=a(107)(s.a,i.a,null,null,null);t.default=n.exports},1291:function(e,t,a){"use strict";var s=a(1292),i=(a.n(s),a(1293)),n=a(1296),l=a(776),r=a(856),o=a(920),c=a(392),u=(a.n(c),!1);t.a={name:"MetadataManagement",components:{TableFilter:i.a,FieldFilter:n.a,BreadCrumb:l.a},data:function(){return{refreshCache:!1,showViewType:0,filter:{keyword:"",type:0},options:[{value:0,label:"库"},{value:1,label:"表"},{value:2,label:"字段"}],table:{isLoading:!1,data:[],total:0,currentPage:1,pageSize:10,pageSizes:[10,20,30,40,50,100]},showAllTable:!0,job:null,updateStatus:"",updateError:"",updateInfo:"",updatePercent:0,isLoading:!1}},computed:{isUpdating:function(){var e=this.updateInfo,t=this.updateStatus,a=this.isLoading;return e&&"error"!==t&&"success"!==t&&!a},isUpdateError:function(){return"error"===this.updateStatus},isUpdateSuccess:function(){return"success"===this.updateStatus}},beforeRouteEnter:function(e,t,a){u=e.meta.keepAlive,a()},beforeRouteLeave:function(e,t,a){t.meta.keepAlive=!1,Object(c.clearTimeout)(this.job),a()},activated:function(){!1===u&&(this.showViewType=0,this.filter.keyword="",this.filter.type=0,this.table.data=[],this.table.total=0,this.table.currentPage=1,this.table.pageSize=10,this.init())},mounted:function(){this.init()},methods:{init:function(){this.getMetaList(!0),this.getProgress()},supplementData:function(){var e=this;this.$Modal.confirm({title:"提示",content:"增量同步元数据需要花费较长时间，确认开始同步吗？",onOk:function(){r.j().then(function(t){e.getProgress()})}})},getProgress:function(){var e=this;e.job=Object(c.setTimeout)(function t(){r.f().then(function(a){var s=a.total,i=a.updated,n=a.error,l=a.startTime;if(s||l)if(n)e.isLoading=!1,e.updateStatus="error",e.updateError=n,Object(c.clearTimeout)(e.job);else{var r=i/s*100,o=parseFloat(r.toFixed(1));e.updatePercent=o,e.updateInfo=i+"/"+s,100===r?(e.isLoading=!1,e.updateStatus="success",Object(c.clearTimeout)(e.job)):s?(e.isLoading=!1,e.updateStatus="",e.job=Object(c.setTimeout)(t,1e4)):(e.isLoading=!0,e.updateStatus="",e.job=Object(c.setTimeout)(t,1e4))}else e.updateInfo=""})},0)},getClassName:function(e){return"DELETED"===e.row.status?this.showAllTable?"delete-status":"hide-row":""},closeAll:function(){var e=this;this.table.data.forEach(function(t){e.$refs.table.toggleRowExpansion(t,!1)})},toCreateView:function(){this.$router.push({path:"/main/metadata/create"})},toDetail:function(e){this.$router.push({path:"/main/metadata/detail/"+e})},handleExpandShow:function(){var e=this;this.$nextTick(function(){if(e.$refs.table){var t=[].slice.call(e.$refs.table.$el.querySelectorAll(".el-table__row"));e.table.data.forEach(function(e,a){e.tableList.length?t[a].querySelector(".el-table__expand-column .cell").style.visibility="visible":t[a].querySelector(".el-table__expand-column .cell").style.visibility="hidden"})}})},refreshData:function(){var e=this;this.refreshCache||(this.refreshCache=!0,o.a().then(function(t){e.handleSearch()}).catch(function(t){e.refreshCache=!1}))},handleSearch:function(){var e=this;switch(this.filter.type){case 0:this.showViewType=0,this.getMetaList(!this.refreshCache,this.refreshCache).then(function(t){e.refreshCache=!1});break;case 1:this.showViewType=1,this.$nextTick(function(){e.$refs["table-filter"].getListByTable(e.filter.keyword,e.refreshCache).then(function(t){e.refreshCache=!1})});break;case 2:this.showViewType=2,this.$nextTick(function(){e.$refs["field-filter"].getListByField(e.filter.keyword,e.refreshCache).then(function(t){e.refreshCache=!1})})}},getMetaList:function(e,t){var a=this;this.table.isLoading=!0,e&&(this.table.currentPage=1);var s=this.filter.keyword;return r.d({query:this.filter.keyword,offset:(this.table.currentPage-1)*this.table.pageSize,limit:this.table.pageSize}).then(function(e){a.filter.keyword===s&&(a.table.isLoading=!1,a.table.total=e.sum,e.lists.forEach(function(e){e.tableList=[]}),a.table.data=e.lists.map(function(e){return e.tableList=[],e.loading=!1,e}))}).catch(function(e){a.table.isLoading=!1})},showMore:function(e,t){e.loading=!0,r.i({databaseId:e.databaseId,offset:e.offset+10,limit:10}).then(function(t){e.tableList=e.tableList.concat(t.lists),e.offset=t.offset,e.count=t.count,e.sum=t.sum,e.loading=!1})},pageChange:function(e){this.table.currentPage=e,this.getMetaList()},pageSizeChange:function(e){this.table.pageSize=e,this.table.currentPage=1,this.getMetaList()},expandChange:function(e,t){e.tableList&&e.tableList.length||(e.loading=!0,r.i({databaseId:e.databaseId,offset:0,limit:10}).then(function(t){e.tableList=t.lists,e.offset=t.offset,e.count=t.count,e.sum=t.sum,e.loading=!1}))}}}},1292:function(e,t){},1293:function(e,t,a){"use strict";var s=a(1294),i=a(1295),n=a(107)(s.a,i.a,null,null,null);t.a=n.exports},1294:function(e,t,a){"use strict";var s=a(1019),i=(a.n(s),a(856));t.a={props:{refreshCache:{type:Boolean,default:!1},showAllTable:{type:Boolean,default:!1}},data:function(){return{searchText:this.searchText,table:{isLoading:!1,data:[],total:0,currentPage:1,pageSize:10,pageSizes:[10,20,30,40,50,100]}}},computed:{allTableVisible:function(){return this.showAllTable}},methods:{getClassName:function(e){return"DELETED"===e.row.status?"delete-status":""},getStyle:function(e){var t=e.row;if(!this.allTableVisible&&("DELETED"===t.status||t.virtualTable))return{display:"none"}},toTableDetail:function(e){this.$router.push({path:"/main/metadata/detail/"+e})},getListByTable:function(e,t){return this.searchText=e,this.getList(!t,t)},getList:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.table.isLoading=!0,e&&(this.table.currentPage=1);var a=this.searchText;return i.e({query:this.searchText,offset:(this.table.currentPage-1)*this.table.pageSize,limit:this.table.pageSize}).then(function(e){t.searchText===a&&(t.table.isLoading=!1,t.table.total=e.sum,t.table.data=e.lists)}).catch(function(e){t.table.isLoading=!1})},pageChange:function(e){this.table.currentPage=e,this.getList()},pageSizeChange:function(e){this.table.pageSize=e,this.table.currentPage=1,this.getList()}}}},1295:function(e,t,a){"use strict";var s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"metadata-management-table-filter-page"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.table.isLoading||e.refreshCache,expression:"table.isLoading || refreshCache"}],staticClass:"relative"},[a("el-table",{ref:"table",attrs:{"row-class-name":e.getClassName,data:e.table.data,"row-style":e.getStyle}},[a("el-table-column",{attrs:{"class-name":"cell-filter-item"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("a",{on:{click:function(a){return e.toTableDetail(t.row.tableId)}}},[a("i",{staticClass:"iconfont icon-biaoge icon-item"}),e._v(" "),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.tableName))])])]),e._v(" "),a("div",[a("i",{staticClass:"iconfont icon-yuanshuju"}),e._v(" "),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.databaseName))]),e._v(" "),a("i",{staticClass:"gs-icon-down",style:{transform:"rotate(-90deg)"}}),e._v(" "),a("i",{staticClass:"iconfont icon-biaoge icon-item"}),e._v(" "),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.tableName))])])]}}])})],1),e._v(" "),a("gs-pagination",{directives:[{name:"show",rawName:"v-show",value:e.table.total>0,expression:"table.total>0"}],attrs:{current:e.table.currentPage,total:e.table.total,"page-size":e.table.pageSize,"page-sizes":e.table.pageSizes,layout:"range,total,pagesizes,pager,jumper,jumpbtn"},on:{"page-change":e.pageChange,"page-size-change":e.pageSizeChange}})],1)])},staticRenderFns:[]};t.a=s},1296:function(e,t,a){"use strict";var s=a(1297),i=a(1298),n=a(107)(s.a,i.a,null,null,null);t.a=n.exports},1297:function(e,t,a){"use strict";var s=a(1019),i=(a.n(s),a(856));t.a={props:{refreshCache:{type:Boolean,default:!1}},data:function(){return{searchText:null,table:{isLoading:!1,data:[],total:0,currentPage:1,pageSize:10,pageSizes:[10,20,30,40,50,100]}}},mounted:function(){},methods:{getClassName:function(e){return"DELETED"===e.row.status?"delete-status":""},toTableFieldDetail:function(e){this.$router.push({path:"/main/metadata/detail/"+e,query:{module:"field"}})},getListByField:function(e,t){return this.searchText=e,this.getList(!t,t)},getList:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.table.isLoading=!0,e&&(this.table.currentPage=1);var a=this.searchText;return i.b({query:this.searchText,offset:(this.table.currentPage-1)*this.table.pageSize,limit:this.table.pageSize}).then(function(e){t.searchText===a&&(t.table.isLoading=!1,t.table.total=e.sum,t.table.data=e.lists)}).catch(function(e){t.table.isLoading=!1})},pageChange:function(e){this.table.currentPage=e,this.getList()},pageSizeChange:function(e){this.table.pageSize=e,this.table.currentPage=1,this.getList()}}}},1298:function(e,t,a){"use strict";var s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"metadata-management-field-filter-page"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.table.isLoading||e.refreshCache,expression:"table.isLoading || refreshCache"}],staticClass:"relative"},[a("el-table",{ref:"table",attrs:{"row-class-name":e.getClassName,data:e.table.data}},[a("el-table-column",{attrs:{"class-name":"cell-filter-item"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("a",{on:{click:function(a){return e.toTableFieldDetail(t.row.tableId)}}},[a("i",{staticClass:"iconfont icon-ziduantubiao"}),e._v(" "),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.columnName))])])]),e._v(" "),a("div",[a("i",{staticClass:"iconfont icon-yuanshuju"}),e._v(" "),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.databaseName))]),e._v(" "),a("i",{staticClass:"gs-icon-down",style:{transform:"rotate(-90deg)"}}),e._v(" "),a("i",{staticClass:"iconfont icon-biaoge icon-item"}),e._v(" "),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.tableName))]),e._v(" "),a("i",{staticClass:"gs-icon-down",style:{transform:"rotate(-90deg)"}}),e._v(" "),a("i",{staticClass:"iconfont icon-ziduantubiao icon-item"}),e._v(" "),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.columnName))])])]}}])})],1),e._v(" "),a("gs-pagination",{directives:[{name:"show",rawName:"v-show",value:e.table.total>0,expression:"table.total>0"}],attrs:{current:e.table.currentPage,total:e.table.total,"page-size":e.table.pageSize,"page-sizes":e.table.pageSizes,layout:"range,total,pagesizes,pager,jumper,jumpbtn"},on:{"page-change":e.pageChange,"page-size-change":e.pageSizeChange}})],1)])},staticRenderFns:[]};t.a=s},1299:function(e,t,a){"use strict";var s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"metadata-management-page"},[a("div",{staticClass:"header-action-button"},[e.isLoading?a("span",{staticClass:"progress-info"},[e._v("(同步启动中...)")]):e._e(),e._v(" "),e.isUpdating?a("span",{staticClass:"progress-info"},[e._v("(同步进度..."+e._s(e.updateInfo)+")")]):e._e(),e._v(" "),e.isUpdateSuccess?a("span",{staticClass:"progress-info"},[e._v("(同步已完成"),a("gs-icon",{attrs:{name:"check-circle"}}),e._v(")")],1):e._e(),e._v(" "),e.isUpdateError?a("span",{staticClass:"progress-info"},[e._v("\n      (同步发生错误..."+e._s(e.updateInfo)+"\n      "),a("gs-tooltip",{attrs:{title:e.updateError,placement:"left"}},[a("gs-icon",{attrs:{name:"exclamation-circle"}})],1),e._v("\n      )\n    ")],1):e._e(),e._v(" "),a("gs-button",{staticClass:"supplement-data",attrs:{disabled:!!e.updateInfo&&!e.updateStatus,type:"primary"},on:{click:e.supplementData}},[e._v("增量同步元数据")])],1),e._v(" "),a("div",{staticClass:"content-header"},[a("bread-crumb",{attrs:{"current-level":"元数据管理"}},[a("div",{staticClass:"bread-crumb-metadata-header",attrs:{slot:"header"},slot:"header"},[e._v("元数据管理\n        "),a("span",{staticClass:"refresh-data"},[a("a",{on:{click:e.refreshData}},[a("i",{staticClass:"iconfont icon-shuaxin2",class:{"animation-rotate":e.refreshCache}})])])])])],1),e._v(" "),a("div",{staticClass:"content-body"},[a("div",{staticClass:"filter-content"},[a("div",{staticClass:"filter"},[a("gs-checkbox",{model:{value:e.showAllTable,callback:function(t){e.showAllTable=t},expression:"showAllTable"}},[e._v("显示所有表和库")])],1),e._v(" "),a("div",{staticClass:"search-filter"},[a("gs-search",{attrs:{disabled:e.refreshCache,placeholder:"请输入搜索内容..."},on:{search:e.handleSearch},model:{value:e.filter.keyword,callback:function(t){e.$set(e.filter,"keyword",t)},expression:"filter.keyword"}},[a("template",{slot:"prepend"},[a("gs-select",{attrs:{disabled:e.refreshCache},model:{value:e.filter.type,callback:function(t){e.$set(e.filter,"type",t)},expression:"filter.type"}},e._l(e.options,function(e){return a("gs-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],2)],1),e._v(" "),a("gs-button",{staticClass:"pull-right expand-all",attrs:{type:"text-primary"},on:{click:e.closeAll}},[e._v("全部收起")])],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.table.isLoading||e.refreshCache,expression:"table.isLoading || refreshCache"},{name:"show",rawName:"v-show",value:0===e.showViewType,expression:"showViewType === 0"}],staticClass:"relative db-list"},[a("el-table",{ref:"table",attrs:{"row-class-name":e.getClassName,data:e.table.data,stripe:""},on:{"expand-change":e.expandChange}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.row.loading,expression:"props.row.loading"}],attrs:{"show-header":!1,"row-class-name":e.getClassName,data:t.row.tableList,stripe:""}},[a("el-table-column",{attrs:{prop:"filename",label:"数据名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"title",on:{click:function(a){return e.toDetail(t.row.tableId)}}},[a("i",{staticClass:"iconfont icon-biaoge icon-item"}),e._v("\n                    "+e._s(t.row.tableName)+"\n                  ")])]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{prop:"description",label:"描述","class-name":"expand-second-column","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"user",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("gs-button",{attrs:{type:"text-primary"},on:{click:function(a){return e.toDetail(t.row.tableId)}}},[e._v("详情")])]}}],null,!0)})],1),e._v(" "),t.row.tableList.length<t.row.sum?a("div",{staticClass:"text-center show-more"},[a("gs-button",{attrs:{loading:t.row.loading},on:{click:function(a){return e.showMore(t.row,t.$index)}}},[e._v("点击加载更多")])],1):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"数据名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("i",{staticClass:"iconfont icon-yuanshuju"}),e._v(" "),a("span",{staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.row.databaseName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"描述",prop:"databaseDescription","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("-")])]}}])})],1),e._v(" "),a("gs-pagination",{directives:[{name:"show",rawName:"v-show",value:e.table.total>0,expression:"table.total>0"}],attrs:{current:e.table.currentPage,total:e.table.total,"page-size":e.table.pageSize,"page-sizes":e.table.pageSizes,layout:"range,total,pagesizes,pager,jumper,jumpbtn"},on:{"page-change":e.pageChange,"page-size-change":e.pageSizeChange}})],1),e._v(" "),a("table-filter",{directives:[{name:"show",rawName:"v-show",value:1===e.showViewType,expression:"showViewType === 1"}],ref:"table-filter",attrs:{"show-all-table":e.showAllTable,"refresh-cache":e.refreshCache}}),e._v(" "),a("field-filter",{directives:[{name:"show",rawName:"v-show",value:2===e.showViewType,expression:"showViewType === 2"}],ref:"field-filter",attrs:{"refresh-cache":e.refreshCache}})],1)])},staticRenderFns:[]};t.a=s},776:function(e,t,a){"use strict";var s=a(777),i=a(780);a.n(i);t.a=s.a},777:function(e,t,a){"use strict";var s=a(778),i=a(779),n=a(107)(s.a,i.a,null,null,null);t.a=n.exports},778:function(e,t,a){"use strict";t.a={name:"BreadCrumb",props:{currentLevel:{type:String,required:!0},upperLevel:{type:String,default:""},backPath:{type:String,default:""}},data:function(){return{}},computed:{isHideNav:function(){return!!this.$router.currentRoute.query.nav}},methods:{backBtnClick:function(){this.$emit("back")}}}},779:function(e,t,a){"use strict";var s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return!e.upperLevel||e.isHideNav?a("div",{staticClass:"content-header-single"},[e._t("header",[e._v("\n    "+e._s(e.currentLevel)+"\n  ")])],2):a("div",{staticClass:"content-header-both"},[a("div",{staticClass:"back-link"},[a("router-link",{attrs:{to:e.backPath}},[a("gs-button",{staticClass:"back-btn",attrs:{type:"primary"},on:{click:e.backBtnClick}},[a("i",{staticClass:"gs-icon gs-icon-revoke"})])],1)],1),e._v(" "),a("div",{staticClass:"nav-name"},[a("div",{staticClass:"current-nav"},[e._v(e._s(e.currentLevel))]),e._v(" "),a("div",{staticClass:"upper-nav"},[e._v(e._s(e.upperLevel))])])])},staticRenderFns:[]};t.a=s},780:function(e,t){}});
//# sourceMappingURL=15.6225c9e8.js.map