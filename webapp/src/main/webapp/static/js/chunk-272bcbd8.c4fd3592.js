(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-272bcbd8"],{"138d":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"data-list"},[i("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataTable",on:{"sort-change":e.sortChange,"selection-change":e.handleSelectionChange}},"el-table",e.tableProps,!1),[e._t("default")],2),i("gs-pagination",e._b({attrs:{"page-sizes":[10,20,30,40,50,100],layout:e.paginationProps.layout||"range,total,pagesizes,pager,jumper,jumpbtn"},on:{"page-change":e.pageChange,"page-size-change":e.pageSizeChange}},"gs-pagination",e.paginationProps,!1))],1)},a=[],s={props:{tableProps:{type:Object,default:function(){return{}}},paginationProps:{type:Object,default:function(){return{}}},loading:{type:Boolean,default:!1}},methods:{sortChange:function(e){var t=e.column,i=e.prop,n=e.order;this.$emit("sort-change",{column:t,prop:i,order:n})},handleSelectionChange:function(e){this.$emit("selection-change",e)},pageChange:function(e){this.$emit("page-change",e)},pageSizeChange:function(e){this.$emit("page-size-change",e)},clearSelection:function(){this.$refs.dataTable.clearSelection()},getTable:function(){return this.$refs.dataTable},doLayout:function(){this.$refs.dataTable.doLayout()}}},r=s,o=i("2877"),l=Object(o["a"])(r,n,a,!1,null,null,null),c=l.exports;t["a"]=c},"2b0b":function(e,t,i){"use strict";i.d(t,"f",function(){return a}),i.d(t,"b",function(){return s}),i.d(t,"e",function(){return r}),i.d(t,"d",function(){return o}),i.d(t,"a",function(){return l}),i.d(t,"c",function(){return c}),i.d(t,"g",function(){return u});var n=i("751a");function a(e){return n["a"].post("/privilege/privileges",e)}function s(e){return n["a"].delete("/privilege/".concat(e))}function r(e){return n["a"].get("/privilege/".concat(e))}function o(){return n["a"].get("/privilege/modules")}function l(e){return n["a"].post("/privilege",e)}function c(e,t){return n["a"].put("/privilege/".concat(e),t)}function u(e){return n["a"].post("/privilege/roles",e)}},7263:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"role-detail"},[i("gs-tabs",{attrs:{type:"content-tab"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("gs-tab-pane",{attrs:{label:"成员",name:"member"}},[i("member")],1),i("gs-tab-pane",{attrs:{label:"权限",name:"authorize"}},[i("authorize")],1)],1)],1)},a=[],s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"authorize"},[i("div",{staticClass:"header"},[i("div",{staticClass:"title"},[i("span",{staticClass:"label"},[e._v("权限方案:")]),e.edit?i("gs-select",{staticClass:"doc-select",attrs:{"popper-class":"searchable-select"},on:{change:e.changePrivilegeOption},model:{value:e.privilegeId,callback:function(t){e.privilegeId=t},expression:"privilegeId"}},e._l(e.privilegesOptions,function(e){return i("gs-option",{key:e.privilegeId,attrs:{label:e.privilegeName,value:e.privilegeId}})}),1):i("span",[e._v(e._s(e.privilege.privilegeName))])],1),i("div",{staticClass:"operation-box"},[i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.allowEdit&&!e.edit,expression:"allowEdit && !edit"}],attrs:{type:"text-primary"},on:{click:e.editPrivilege}},[e._v("\n        编辑\n      ")]),i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}],attrs:{type:"text-primary"},on:{click:e.changePrivilege}},[e._v("\n        确定\n      ")]),i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}],attrs:{type:"text-primary"},on:{click:e.cancel}},[e._v("\n        取消\n      ")])],1)]),i("div",{staticClass:"wrap"},[i("div",{staticClass:"left"},[i("div",{staticClass:"authorize-module"},[i("div",{staticClass:"title"},[e._v("\n          授权模块\n        ")]),e._l(e.privilege.modules.filter(function(e){return e.type})||[],function(t){return i("p",{key:t.moduleId},[i("i",{staticClass:"gs-icon-check"}),e._v(e._s(t.moduleName)+"\n        ")])})],2),i("div",{staticClass:"business-obj-ope"},[i("div",{staticClass:"title"},[e._v("\n          管理权限\n        ")]),e._l(e.privilege.modules.filter(function(e){return!e.type})||[],function(t){return i("p",{key:t.moduleId},[i("i",{staticClass:"gs-icon-check"}),e._v(e._s(t.moduleName)+"\n        ")])})],2)]),i("div",{staticClass:"right"},[i("div",{staticClass:"title"},[e._v("\n        授权范围\n      ")]),i("div",{staticClass:"wrapper"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.privilege.modules.some(function(e){return 1===e.moduleId}),expression:"privilege.modules.some(item =>item.moduleId === 1)"}],staticClass:"technical"},[i("div",{staticClass:"sub-title"},[e._v("\n            技术目录\n          ")]),i("gs-tree",{ref:"technicalTree",attrs:{data:e.technicalCategories,props:{label:"name",className:"hide"},"render-content":e.renderTree,"node-key":"guid"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:e.privilege.modules.some(function(e){return[2,5].includes(e.moduleId)}),expression:"privilege.modules.some(item => [2, 5].includes(item.moduleId))"}],staticClass:"bussiness"},[i("div",{staticClass:"sub-title"},[e._v("\n            业务目录\n          ")]),i("gs-tree",{ref:"businessTree",attrs:{data:e.businessCategories,props:{label:"name"},"render-content":e.renderTree,"node-key":"guid"}})],1)])])])])},r=[],o=i("75fc"),l=(i("7f7f"),i("ed08")),c=i("b369"),u=i("2b0b"),d={data:function(){return{privilege:{privilegeName:"",modules:[]},storePrivilege:{},roleId:"",technicalCategories:[],businessCategories:[],edit:!1,privilegesOptions:[],privilegeId:"",businessCheck:[],technicalCheck:[],loading:!1,allowEdit:!1}},created:function(){this.roleId=this.$route.params.id,this.fetchRolePrivilege()},methods:{fetchRolePrivilege:function(){var e=this;this.loading=!0,c["h"]({limit:-1,query:""}).then(function(t){e.privilegesOptions=t.lists}),c["j"](this.roleId).then(function(t){if(e.allowEdit=!!t.edit,t.technicalCategories&&t.technicalCategories.length){t.technicalCategories.map(function(t){return t.disabled=!t.show,t.status&&e.technicalCheck.push(t.guid),t});var i=Object(l["e"])(t.technicalCategories,"guid","parentCategoryGuid"),n=Object(l["f"])(i,"guid","upBrotherCategoryGuid","downBrotherCategoryGuid");e.technicalCategories=Object(l["d"])(n,!0,"hide",!1)}if(t.businessCategories&&t.businessCategories.length){t.businessCategories.map(function(t){return t.disabled=!t.show,t.status&&e.businessCheck.push(t.guid),t});var a=Object(l["e"])(t.businessCategories,"guid","parentCategoryGuid"),s=Object(l["f"])(a,"guid","upBrotherCategoryGuid","downBrotherCategoryGuid");e.businessCategories=Object(l["d"])(s,!0,"hide",!1)}e.privilegeId=t.privilege.privilegeId,e.privilege=t.privilege,e.storePrivilege=JSON.parse(JSON.stringify(t.privilege)),e.loading=!1})},renderTree:function(e,t){t.node;var i=t.data,n=this.edit;return i.hide?e("div"):e("span",[n?e("gs-checkbox",{attrs:{value:!!i.status,disabled:!i.show},on:{change:this.categoryChange.bind(this,i)}}):i.status?e("i",{class:"gs-icon-check"}):null,e("span",[i.name])])},filterNode:function(e){function t(e){return e=e.filter(function(e){return e.children&&(e.children=t(e.children)),!e.hide}),e}return t(e)},categoryChange:function(e){var t=function e(t,i){t.children&&t.children.map(function(t){return t.children?(t.status=i,e(t,i)):(t.status=i,t)})};e.status=1===e.status?0:1,t(e,e.status)},changePrivilege:function(){var e=this,t={};t.privilege={privilegeId:this.privilegeId,modules:this.privilege.modules};var i=function(e){function t(e){var i=function(e){var t;return(t=[]).concat.apply(t,Object(o["a"])(e))};return i(e.map(function(e){return Array.isArray(e.children)&&0===e.status?[].concat(Object(o["a"])(e),Object(o["a"])(t(e.children))):e}))}return t(e).filter(function(e){return 1===e.status}).map(function(e){return e.guid})},n=i(this.technicalCategories),a=i(this.businessCategories);n&&n.length&&(t.technicalCategories=n.map(function(e){return{guid:e,status:1}})),a&&a.length&&(t.businessCategories=a.map(function(e){return{guid:e,status:1}})),c["b"]({params:t,roleId:this.roleId}).then(function(t){e.edit=!1,e.$Message.success("修改成功"),e.fetchRolePrivilege()})},changePrivilegeOption:function(e){var t=this;u["e"](e).then(function(e){t.privilege.modules=e.modules})},cancel:function(){this.edit=!1,this.privilege=JSON.parse(JSON.stringify(this.storePrivilege)),this.privilegeId=this.privilege.privilegeId,this.technicalCategories=JSON.parse(this.copyTechnicalTree),this.businessCategories=JSON.parse(this.copyBusinessTree)},editPrivilege:function(){this.edit=!0,this.copyTechnicalTree=JSON.stringify(this.technicalCategories),this.copyBusinessTree=JSON.stringify(this.businessCategories)}}},g=d,p=i("2877"),h=Object(p["a"])(g,s,r,!1,null,null,null),f=h.exports,v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"member"},[i("div",{staticClass:"search-box",class:{"flex-end":"1"===e.roleId},staticStyle:{"justify-content":"flex-end"}},[i("gs-search",{attrs:{placeholder:"请输入用户名或帐号"},on:{clear:function(t){return e.fetchMemberList(1)},search:e.fetchMemberList},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),i("data-table",{attrs:{loading:e.loading,"table-props":{data:e.tableData},"pagination-props":e.pagination},on:{"page-change":e.pageChange,"page-size-change":e.sizeChange,"selection-change":e.selectionChange}},[i("el-table-column",{attrs:{type:"selection",fixed:""}}),i("el-table-column",{attrs:{prop:"account",label:"帐号","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"username",label:"用户名","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"roleName",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.roles,function(t){return i("gs-tag",{key:t},[e._v("\n          "+e._s(t)+"\n        ")])})}}])})],1)],1)},m=[],b=(i("e98a"),i("138d")),C={components:{dataTable:b["a"]},data:function(){return{keyword:"",tableData:[],pagination:{total:0,pageSize:10,pageSizes:[10,20,30],current:1},loading:!1,selection:[],roleId:""}},computed:{},created:function(){this.roleId=this.$route.params.id,this.fetchMemberList(1)},methods:{fetchMemberList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;1===t&&(this.pagination.current=1),this.loading=!0,c["g"](this.roleId,{offset:(this.pagination.current-1)*this.pagination.pageSize,limit:this.pagination.pageSize,query:this.keyword}).then(function(t){t.lists.map(function(e){return e.roles=[e.roleName],e}),e.tableData=t.lists,e.pagination.total=t.sum||0,e.loading=!1}).catch(function(t){e.loading=!1})},pageChange:function(e){this.pagination.current=e,this.fetchMemberList()},sizeChange:function(e){this.pagination.pageSize=e,this.fetchMemberList(1)},removeMember:function(){var e=this;if(this.selection.length){var t=this.selection.map(function(e){return e.userId});this.$Modal.confirm({title:"警告",content:"是否删除该成员？删除后将无法恢复",onOk:function(){c["d"](e.roleId,t).then(function(t){e.$Message.success("删除成员成功"),e.fetchMemberList()})}})}else this.$Message.warning("请选择成员")},selectionChange:function(e){this.selection=e}}},y=C,w=Object(p["a"])(y,v,m,!1,null,null,null),_=w.exports,I={components:{authorize:f,member:_},data:function(){return{activeName:"member"}}},k=I,O=Object(p["a"])(k,n,a,!1,null,null,null);t["default"]=O.exports},b369:function(e,t,i){"use strict";i.d(t,"i",function(){return a}),i.d(t,"e",function(){return s}),i.d(t,"h",function(){return r}),i.d(t,"a",function(){return o}),i.d(t,"f",function(){return l}),i.d(t,"g",function(){return c}),i.d(t,"d",function(){return u}),i.d(t,"j",function(){return d}),i.d(t,"b",function(){return g}),i.d(t,"c",function(){return p});var n=i("751a");function a(e){return n["a"].post("/role/roles",e)}function s(e){return n["a"].delete("/role/".concat(e))}function r(e){return n["a"].post("/role/privileges",e)}function o(e){return n["a"].post("/role",e)}function l(e){var t=e.params,i=e.roleId;return n["a"].put("/role/".concat(i),t)}function c(e,t){return n["a"].post("/role/".concat(e,"/users"),t)}function u(e,t){return n["a"].delete("/role/".concat(e,"/user"),{data:t})}function d(e){return n["a"].get("/role/".concat(e,"/privileges"))}function g(e){var t=e.params,i=e.roleId;return n["a"].put("/role/".concat(i,"/privileges"),t)}function p(e){var t=e.roleId,i=e.status;return n["a"].put("/role/".concat(t,"/").concat(i))}},e98a:function(e,t,i){}}]);
//# sourceMappingURL=chunk-272bcbd8.c4fd3592.js.map