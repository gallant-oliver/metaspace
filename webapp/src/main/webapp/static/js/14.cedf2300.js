webpackJsonp([14],{2066:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(2067),r=i(2078),n=i(366)(s.a,r.a,null,null,null);t.default=n.exports},2067:function(e,t,i){"use strict";var s=i(2068),r=i(2071);t.a={components:{authorize:s.a,member:r.a},data:function(){return{activeName:"member"}}}},2068:function(e,t,i){"use strict";var s=i(2069),r=i(2070),n=i(366)(s.a,r.a,null,null,null);t.a=n.exports},2069:function(e,t,i){"use strict";var s=i(149),r=i.n(s),n=i(808),a=i(807),l=i(867);t.a={data:function(){return{privilege:{privilegeName:"",modules:[]},storePrivilege:{},roleId:"",technicalCategories:[],businessCategories:[],edit:!1,privilegesOptions:[],privilegeId:"",businessCheck:[],technicalCheck:[],loading:!1,allowEdit:!1}},created:function(){this.roleId=this.$route.params.id,this.fetchRolePrivilege()},methods:{fetchRolePrivilege:function(){var e=this;this.loading=!0,a.i({limit:-1,query:""}).then(function(t){e.privilegesOptions=t.lists}),a.k(this.roleId).then(function(t){if(e.allowEdit=!!t.edit,t.technicalCategories&&t.technicalCategories.length){t.technicalCategories.map(function(t){return t.disabled=!t.show,t.status&&e.technicalCheck.push(t.guid),t});var i=Object(n.c)(t.technicalCategories,"guid","parentCategoryGuid"),s=Object(n.d)(i,"guid","upBrotherCategoryGuid","downBrotherCategoryGuid");e.technicalCategories=Object(n.b)(s,!0,"hide")}if(t.businessCategories&&t.businessCategories.length){t.businessCategories.map(function(t){return t.disabled=!t.show,t.status&&e.businessCheck.push(t.guid),t});var a=Object(n.c)(t.businessCategories,"guid","parentCategoryGuid"),l=Object(n.d)(a,"guid","upBrotherCategoryGuid","downBrotherCategoryGuid");e.businessCategories=Object(n.b)(l,!0,"hide")}e.privilegeId=t.privilege.privilegeId,e.privilege=t.privilege,e.storePrivilege=JSON.parse(r()(t.privilege)),e.loading=!1})},renderTree:function(e,t){t.node;var i=t.data,s=this.edit;return i.hide?e("div",["1"]):e("span",[s?e("gs-checkbox",{attrs:{value:!!i.status,disabled:!i.show},on:{change:this.categoryChange.bind(this,i)}}):i.status?e("i",{class:"gs-icon-check"}):null,e("span",[i.name])])},filterNode:function(e){return function e(t){return t=t.filter(function(t){return t.children&&(t.children=e(t.children)),!t.hide})}(e)},categoryChange:function(e){e.status=1===e.status?0:1,function e(t,i){t.children&&t.children.map(function(t){return t.children?(t.status=i,e(t,i)):(t.status=i,t)})}(e,e.status)},changePrivilege:function(){var e=this,t={};t.privilege={privilegeId:this.privilegeId,modules:this.privilege.modules};var i=function(e){return function e(t){return function(e){var t;return(t=[]).concat.apply(t,e)}(t.map(function(t){return Array.isArray(t.children)&&0===t.status?[].concat(t,e(t.children)):t}))}(e).filter(function(e){return 1===e.status}).map(function(e){return e.guid})},s=i(this.technicalCategories),r=i(this.businessCategories);s&&s.length&&(t.technicalCategories=s.map(function(e){return{guid:e,status:1}})),r&&r.length&&(t.businessCategories=r.map(function(e){return{guid:e,status:1}})),a.c({params:t,roleId:this.roleId}).then(function(t){e.edit=!1,e.$Message.success("修改成功"),e.fetchRolePrivilege()})},changePrivilegeOption:function(e){var t=this;l.e(e).then(function(e){t.privilege.modules=e.modules})},cancel:function(){this.edit=!1,this.privilege=JSON.parse(r()(this.storePrivilege)),this.privilegeId=this.privilege.privilegeId,this.technicalCategories=JSON.parse(this.copyTechnicalTree),this.businessCategories=JSON.parse(this.copyBusinessTree)},editPrivilege:function(){this.edit=!0,this.copyTechnicalTree=r()(this.technicalCategories),this.copyBusinessTree=r()(this.businessCategories)}}}},2070:function(e,t,i){"use strict";var s={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"authorize"},[i("div",{staticClass:"header"},[i("div",{staticClass:"title"},[i("span",{staticClass:"label"},[e._v("权限方案:")]),e._v(" "),e.edit?i("gs-select",{staticClass:"doc-select",attrs:{"popper-class":"searchable-select"},on:{change:e.changePrivilegeOption},model:{value:e.privilegeId,callback:function(t){e.privilegeId=t},expression:"privilegeId"}},e._l(e.privilegesOptions,function(e){return i("gs-option",{key:e.privilegeId,attrs:{label:e.privilegeName,value:e.privilegeId}})}),1):i("span",[e._v(e._s(e.privilege.privilegeName))])],1),e._v(" "),i("div",{staticClass:"operation-box"},[i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.allowEdit&&!e.edit,expression:"allowEdit && !edit"}],attrs:{type:"text-primary"},on:{click:e.editPrivilege}},[e._v("编辑")]),e._v(" "),i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}],attrs:{type:"text-primary"},on:{click:e.changePrivilege}},[e._v("确定")]),e._v(" "),i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}],attrs:{type:"text-primary"},on:{click:e.cancel}},[e._v("取消")])],1)]),e._v(" "),i("div",{staticClass:"wrap"},[i("div",{staticClass:"left"},[i("div",{staticClass:"authorize-module"},[i("div",{staticClass:"title"},[e._v("授权模块")]),e._v(" "),e._l(e.privilege.modules.filter(function(e){return e.type})||[],function(t){return i("p",{key:t.moduleId},[i("i",{staticClass:"gs-icon-check"}),e._v(e._s(t.moduleName)+"\n        ")])})],2),e._v(" "),i("div",{staticClass:"business-obj-ope"},[i("div",{staticClass:"title"},[e._v("业务对象操作")]),e._v(" "),e._l(e.privilege.modules.filter(function(e){return!e.type})||[],function(t){return i("p",{key:t.moduleId},[i("i",{staticClass:"gs-icon-check"}),e._v(e._s(t.moduleName)+"\n        ")])})],2)]),e._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"title"},[e._v("授权范围")]),e._v(" "),i("div",{staticClass:"wrapper"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.privilege.modules.some(function(e){return 1===e.moduleId}),expression:"privilege.modules.some(item =>item.moduleId === 1)"}],staticClass:"technical"},[i("div",{staticClass:"title"},[e._v("技术目录")]),e._v(" "),i("gs-tree",{ref:"technicalTree",attrs:{data:e.technicalCategories,props:{label:"name",className:"hide"},"render-content":e.renderTree,"node-key":"guid"}})],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.privilege.modules.some(function(e){return[2,5].includes(e.moduleId)}),expression:"privilege.modules.some(item => [2, 5].includes(item.moduleId))"}],staticClass:"bussiness"},[i("div",{staticClass:"title"},[e._v("业务目录")]),e._v(" "),i("gs-tree",{ref:"businessTree",attrs:{data:e.businessCategories,props:{label:"name"},"render-content":e.renderTree,"node-key":"guid"}})],1)])])])])},staticRenderFns:[]};t.a=s},2071:function(e,t,i){"use strict";var s=i(2072),r=i(2077),n=i(366)(s.a,r.a,null,null,null);t.a=n.exports},2072:function(e,t,i){"use strict";var s=i(2073),r=(i.n(s),i(2074)),n=i(807);t.a={components:{addMember:r.a},data:function(){return{keyword:"",tableData:[],pagination:{total:0,pageSize:10,pageSizes:[10,20,30],current:1},loading:!1,selection:[],roleId:""}},computed:{},created:function(){this.roleId=this.$route.params.id,this.fetchMemberList(1)},methods:{fetchMemberList:function(){var e=this;1===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)&&(this.pagination.current=1),this.loading=!0,n.h(this.roleId,{offset:(this.pagination.current-1)*this.pagination.pageSize,limit:this.pagination.pageSize,query:this.keyword}).then(function(t){t.lists.map(function(e){return e.roles=[e.roleName],e}),e.tableData=t.lists,e.pagination.total=t.sum||0,e.loading=!1}).catch(function(t){e.loading=!1})},pageChange:function(e){this.pagination.current=e,this.fetchMemberList()},sizeChange:function(e){this.pagination.pageSize=e,this.fetchMemberList(1)},removeMember:function(){var e=this;if(this.selection.length){var t=this.selection.map(function(e){return e.userId});this.$Modal.confirm({title:"警告",content:"是否删除该成员？删除后将无法恢复",onOk:function(){n.e(e.roleId,t).then(function(t){e.$Message.success("删除成员成功"),e.fetchMemberList()})}})}else this.$Message.warning("请选择成员")},selectionChange:function(e){this.selection=e},addMember:function(e){var t=this;n.a(this.roleId,e).then(function(e){t.$Message.success("添加成员成功"),t.fetchMemberList(1)})}}}},2073:function(e,t){},2074:function(e,t,i){"use strict";var s=i(2075),r=i(2076),n=i(366)(s.a,r.a,null,null,null);t.a=n.exports},2075:function(e,t,i){"use strict";var s=i(807);t.a={props:{roleId:{type:String,required:!0,default:""}},data:function(){return{visible:!1,roleOptions:[],roleFilter:"all",memberOptions:[],keyword:"",selected:[],loading:!1}},methods:{openAddMemberModal:function(){this.visible=!0},removeMember:function(){this.$emit("removeMember")},visibleChange:function(e){var t=this;e&&(this.loading=!0,this.roleFilter="all",this.selected=[],s.j({limit:-1,query:""}).then(function(e){e.lists=[{roleName:"全部",roleId:"all"}].concat(e.lists);var i=e.lists.findIndex(function(e){return e.roleId===t.roleId});-1!==i&&e.lists.splice(i,1),t.roleOptions=e.lists.filter(function(e){return"1"!==e.roleId})}),s.g(this.roleId,{limit:-1,query:this.keyword}).then(function(e){t.memberOptions=e.lists,t.loading=!1}))},addMember:function(){this.selected&&this.selected.length?(this.$emit("addMember",this.selected),this.visible=!1):this.$Message.warning("请选择成员")},handleSearch:function(){var e=this;"all"===this.roleFilter?s.g(this.roleId,{limit:-1,query:this.keyword}).then(function(t){e.memberOptions=t.lists}):s.h(this.roleFilter,{limit:-1,query:this.keyword}).then(function(t){e.memberOptions=t.lists})},roleChange:function(){var e=this;this.keyword="","all"===this.roleFilter?s.g(this.roleId,{limit:-1,query:""}).then(function(t){e.memberOptions=t.lists}):s.h(this.roleFilter,{limit:-1,query:""}).then(function(t){e.memberOptions=t.lists})}}}},2076:function(e,t,i){"use strict";var s={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("gs-button",{attrs:{type:"primary"},on:{click:e.openAddMemberModal}},[e._v("添加成员")]),e._v(" "),i("gs-button",{attrs:{type:"primary"},on:{click:e.removeMember}},[e._v("移除成员")]),e._v(" "),i("gs-modal",{attrs:{title:"添加成员",width:"620px"},on:{"visible-change":e.visibleChange,confirm:e.addMember},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[i("div",{staticClass:"add-member-modal"},[i("gs-search",{staticClass:"search",on:{search:e.handleSearch,clear:e.handleSearch},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[i("template",{slot:"prepend"},[i("gs-select",{on:{change:e.roleChange},model:{value:e.roleFilter,callback:function(t){e.roleFilter=t},expression:"roleFilter"}},e._l(e.roleOptions,function(e){return i("gs-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId,title:e.roleName}})}),1)],1)],2),e._v(" "),i("gs-modal-select",{staticClass:"searchable-modal-select",attrs:{flatten:""},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.memberOptions,function(t){return i("gs-option",{key:t.userId,attrs:{label:t.username,value:t.userId,disabled:!!t.status}},[i("span",[e._v(e._s(t.username))]),e._v(" "),i("span",{staticClass:"role-name"},[e._v("("+e._s(t.roleName)+")")])])}),1)],1),e._v(" "),i("gs-loading",{attrs:{"is-show":e.loading}})],1)],1)},staticRenderFns:[]};t.a=s},2077:function(e,t,i){"use strict";var s={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"member"},[i("div",{staticClass:"search-box",class:{"flex-end":"1"===e.roleId}},["1"!==e.roleId?i("add-member",{attrs:{"role-id":e.roleId},on:{removeMember:e.removeMember,addMember:e.addMember}}):e._e(),e._v(" "),i("gs-search",{attrs:{placeholder:"请输入用户名或帐号"},on:{clear:function(t){e.fetchMemberList(1)},search:e.fetchMemberList},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),e._v(" "),i("gs-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,pagination:e.pagination,paging:""},on:{"size-change":e.sizeChange,"page-change":e.pageChange,"selection-change":e.selectionChange}},[i("gs-table-column",{attrs:{type:"selection",fixed:""}}),e._v(" "),i("gs-table-column",{attrs:{prop:"account",label:"帐号","show-overflow-tooltip":""}}),e._v(" "),i("gs-table-column",{attrs:{prop:"username",label:"用户名","show-overflow-tooltip":""}}),e._v(" "),i("gs-table-column",{attrs:{prop:"roleName",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("gs-table-tags",{attrs:{tags:e.row.roles,"show-count":2}})]}}])})],1)],1)},staticRenderFns:[]};t.a=s},2078:function(e,t,i){"use strict";var s={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"role-detail"},[i("gs-tabs",{attrs:{type:"content-tab"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("gs-tab-pane",{attrs:{label:"成员",name:"member"}},[i("member")],1),e._v(" "),i("gs-tab-pane",{attrs:{label:"权限",name:"authorize"}},[i("authorize")],1)],1)],1)},staticRenderFns:[]};t.a=s},807:function(e,t,i){"use strict";t.j=function(e){return s.a.post("/role/roles",e)},t.f=function(e){return s.a.delete("/role/"+e)},t.i=function(e){return s.a.post("/role/privileges",e)},t.b=function(e){return s.a.post("/role",e)},t.h=function(e,t){return s.a.post("/role/"+e+"/users",t)},t.e=function(e,t){return s.a.delete("/role/"+e+"/user",{data:t})},t.a=function(e,t){return s.a.post("role/"+e+"/user",t)},t.k=function(e){return s.a.get("/role/"+e+"/privileges")},t.c=function(e){var t=e.params,i=e.roleId;return s.a.put("/role/"+i+"/privileges",t)},t.d=function(e){var t=e.roleId,i=e.status;return s.a.put("/role/"+t+"/"+i)},t.g=function(e,t){return s.a.post("/role/users/"+e,t)};var s=i(733)},867:function(e,t,i){"use strict";t.f=function(e){return s.a.post("/privilege/privileges",e)},t.b=function(e){return s.a.delete("/privilege/"+e)},t.e=function(e){return s.a.get("/privilege/"+e)},t.d=function(){return s.a.get("/privilege/modules")},t.a=function(e){return s.a.post("/privilege",e)},t.c=function(e,t){return s.a.put("/privilege/"+e,t)},t.g=function(e){return s.a.post("/privilege/roles",e)};var s=i(733)}});
//# sourceMappingURL=14.cedf2300.js.map