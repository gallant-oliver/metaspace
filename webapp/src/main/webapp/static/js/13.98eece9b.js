webpackJsonp([13],{2122:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(2123),n=i(2134),a=i(108)(s.a,n.a,null,null,null);t.default=a.exports},2123:function(e,t,i){"use strict";var s=i(2124),n=i(2127);t.a={components:{authorize:s.a,member:n.a},data:function(){return{activeName:"member"}}}},2124:function(e,t,i){"use strict";var s=i(2125),n=i(2126),a=i(108)(s.a,n.a,null,null,null);t.a=a.exports},2125:function(e,t,i){"use strict";var s=i(162),n=i.n(s),a=i(788),r=i(849),l=i(923);t.a={data:function(){return{privilege:{privilegeName:"",modules:[]},storePrivilege:{},roleId:"",technicalCategories:[],businessCategories:[],edit:!1,privilegesOptions:[],privilegeId:"",businessCheck:[],technicalCheck:[],loading:!1,allowEdit:!1}},created:function(){this.roleId=this.$route.params.id,this.fetchRolePrivilege()},methods:{fetchRolePrivilege:function(){var e=this;this.loading=!0,r.j({limit:-1,query:""}).then(function(t){e.privilegesOptions=t.lists}),r.l(this.roleId).then(function(t){if(e.allowEdit=!!t.edit,t.technicalCategories&&t.technicalCategories.length){t.technicalCategories.map(function(t){return t.disabled=!t.show,t.status&&e.technicalCheck.push(t.guid),t});var i=Object(a.e)(t.technicalCategories,"guid","parentCategoryGuid"),s=Object(a.f)(i,"guid","upBrotherCategoryGuid","downBrotherCategoryGuid");e.technicalCategories=Object(a.d)(s,!0,"hide",!1)}if(t.businessCategories&&t.businessCategories.length){t.businessCategories.map(function(t){return t.disabled=!t.show,t.status&&e.businessCheck.push(t.guid),t});var r=Object(a.e)(t.businessCategories,"guid","parentCategoryGuid"),l=Object(a.f)(r,"guid","upBrotherCategoryGuid","downBrotherCategoryGuid");e.businessCategories=Object(a.d)(l,!0,"hide",!1)}e.privilegeId=t.privilege.privilegeId,e.privilege=t.privilege,e.storePrivilege=JSON.parse(n()(t.privilege)),e.loading=!1})},renderTree:function(e,t){t.node;var i=t.data,s=this.edit;return i.hide?e("div"):e("span",[s?e("gs-checkbox",{attrs:{value:!!i.status,disabled:!i.show},on:{change:this.categoryChange.bind(this,i)}}):i.status?e("i",{class:"gs-icon-check"}):null,e("span",[i.name])])},filterNode:function(e){return function e(t){return t=t.filter(function(t){return t.children&&(t.children=e(t.children)),!t.hide})}(e)},categoryChange:function(e){e.status=1===e.status?0:1,function e(t,i){t.children&&t.children.map(function(t){return t.children?(t.status=i,e(t,i)):(t.status=i,t)})}(e,e.status)},changePrivilege:function(){var e=this,t={};t.privilege={privilegeId:this.privilegeId,modules:this.privilege.modules};var i=function(e){return function e(t){return function(e){var t;return(t=[]).concat.apply(t,e)}(t.map(function(t){return Array.isArray(t.children)&&0===t.status?[].concat(t,e(t.children)):t}))}(e).filter(function(e){return 1===e.status}).map(function(e){return e.guid})},s=i(this.technicalCategories),n=i(this.businessCategories);s&&s.length&&(t.technicalCategories=s.map(function(e){return{guid:e,status:1}})),n&&n.length&&(t.businessCategories=n.map(function(e){return{guid:e,status:1}})),r.c({params:t,roleId:this.roleId}).then(function(t){e.edit=!1,e.$Message.success("修改成功"),e.fetchRolePrivilege()})},changePrivilegeOption:function(e){var t=this;l.e(e).then(function(e){t.privilege.modules=e.modules})},cancel:function(){this.edit=!1,this.privilege=JSON.parse(n()(this.storePrivilege)),this.privilegeId=this.privilege.privilegeId,this.technicalCategories=JSON.parse(this.copyTechnicalTree),this.businessCategories=JSON.parse(this.copyBusinessTree)},editPrivilege:function(){this.edit=!0,this.copyTechnicalTree=n()(this.technicalCategories),this.copyBusinessTree=n()(this.businessCategories)}}}},2126:function(e,t,i){"use strict";var s={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"authorize"},[i("div",{staticClass:"header"},[i("div",{staticClass:"title"},[i("span",{staticClass:"label"},[e._v("权限方案:")]),e._v(" "),e.edit?i("gs-select",{staticClass:"doc-select",attrs:{"popper-class":"searchable-select"},on:{change:e.changePrivilegeOption},model:{value:e.privilegeId,callback:function(t){e.privilegeId=t},expression:"privilegeId"}},e._l(e.privilegesOptions,function(e){return i("gs-option",{key:e.privilegeId,attrs:{label:e.privilegeName,value:e.privilegeId}})}),1):i("span",[e._v(e._s(e.privilege.privilegeName))])],1),e._v(" "),i("div",{staticClass:"operation-box"},[i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.allowEdit&&!e.edit,expression:"allowEdit && !edit"}],attrs:{type:"text-primary"},on:{click:e.editPrivilege}},[e._v("编辑")]),e._v(" "),i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}],attrs:{type:"text-primary"},on:{click:e.changePrivilege}},[e._v("确定")]),e._v(" "),i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}],attrs:{type:"text-primary"},on:{click:e.cancel}},[e._v("取消")])],1)]),e._v(" "),i("div",{staticClass:"wrap"},[i("div",{staticClass:"left"},[i("div",{staticClass:"authorize-module"},[i("div",{staticClass:"title"},[e._v("授权模块")]),e._v(" "),e._l(e.privilege.modules.filter(function(e){return e.type})||[],function(t){return i("p",{key:t.moduleId},[i("i",{staticClass:"gs-icon-check"}),e._v(e._s(t.moduleName)+"\n        ")])})],2),e._v(" "),i("div",{staticClass:"business-obj-ope"},[i("div",{staticClass:"title"},[e._v("管理权限")]),e._v(" "),e._l(e.privilege.modules.filter(function(e){return!e.type})||[],function(t){return i("p",{key:t.moduleId},[i("i",{staticClass:"gs-icon-check"}),e._v(e._s(t.moduleName)+"\n        ")])})],2)]),e._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"title"},[e._v("授权范围")]),e._v(" "),i("div",{staticClass:"wrapper"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.privilege.modules.some(function(e){return 1===e.moduleId}),expression:"privilege.modules.some(item =>item.moduleId === 1)"}],staticClass:"technical"},[i("div",{staticClass:"sub-title"},[e._v("技术目录")]),e._v(" "),i("gs-tree",{ref:"technicalTree",attrs:{data:e.technicalCategories,props:{label:"name",className:"hide"},"render-content":e.renderTree,"node-key":"guid"}})],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.privilege.modules.some(function(e){return[2,5].includes(e.moduleId)}),expression:"privilege.modules.some(item => [2, 5].includes(item.moduleId))"}],staticClass:"bussiness"},[i("div",{staticClass:"sub-title"},[e._v("业务目录")]),e._v(" "),i("gs-tree",{ref:"businessTree",attrs:{data:e.businessCategories,props:{label:"name"},"render-content":e.renderTree,"node-key":"guid"}})],1)])])])])},staticRenderFns:[]};t.a=s},2127:function(e,t,i){"use strict";var s=i(2128),n=i(2133),a=i(108)(s.a,n.a,null,null,null);t.a=a.exports},2128:function(e,t,i){"use strict";var s=i(2129),n=(i.n(s),i(2130)),a=i(849),r=i(781);t.a={components:{addMember:n.a,dataTable:r.a},data:function(){return{keyword:"",tableData:[],pagination:{total:0,pageSize:10,pageSizes:[10,20,30],current:1},loading:!1,selection:[],roleId:""}},computed:{},created:function(){this.roleId=this.$route.params.id,this.fetchMemberList(1)},methods:{fetchMemberList:function(){var e=this;1===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)&&(this.pagination.current=1),this.loading=!0,a.i(this.roleId,{offset:(this.pagination.current-1)*this.pagination.pageSize,limit:this.pagination.pageSize,query:this.keyword}).then(function(t){t.lists.map(function(e){return e.roles=[e.roleName],e}),e.tableData=t.lists,e.pagination.total=t.sum||0,e.loading=!1}).catch(function(t){e.loading=!1})},pageChange:function(e){this.pagination.current=e,this.fetchMemberList()},sizeChange:function(e){this.pagination.pageSize=e,this.fetchMemberList(1)},removeMember:function(){var e=this;if(this.selection.length){var t=this.selection.map(function(e){return e.userId});this.$Modal.confirm({title:"警告",content:"是否删除该成员？删除后将无法恢复",onOk:function(){a.e(e.roleId,t).then(function(t){e.$Message.success("删除成员成功"),e.fetchMemberList()})}})}else this.$Message.warning("请选择成员")},selectionChange:function(e){this.selection=e},addMember:function(e){var t=this;a.a(this.roleId,e).then(function(e){t.$Message.success("添加成员成功"),t.fetchMemberList(1)})}}}},2129:function(e,t){},2130:function(e,t,i){"use strict";var s=i(2131),n=i(2132),a=i(108)(s.a,n.a,null,null,null);t.a=a.exports},2131:function(e,t,i){"use strict";var s=i(849);t.a={props:{roleId:{type:String,required:!0,default:""}},data:function(){return{visible:!1,roleOptions:[],roleFilter:"all",memberOptions:[],keyword:"",selected:[],loading:!1}},methods:{openAddMemberModal:function(){this.visible=!0},removeMember:function(){this.$emit("removeMember")},visibleChange:function(e){var t=this;e&&(this.loading=!0,this.roleFilter="all",this.selected=[],s.k({limit:-1,query:""}).then(function(e){e.lists=[{roleName:"全部",roleId:"all"}].concat(e.lists);var i=e.lists.findIndex(function(e){return e.roleId===t.roleId});-1!==i&&e.lists.splice(i,1),t.roleOptions=e.lists.filter(function(e){return"1"!==e.roleId})}),s.h(this.roleId,{limit:-1,query:this.keyword}).then(function(e){t.memberOptions=e.lists,t.loading=!1}))},addMember:function(){this.selected&&this.selected.length?(this.$emit("addMember",this.selected),this.visible=!1):this.$Message.warning("请选择成员")},handleSearch:function(){var e=this;"all"===this.roleFilter?s.h(this.roleId,{limit:-1,query:this.keyword}).then(function(t){e.memberOptions=t.lists}):s.i(this.roleFilter,{limit:-1,query:this.keyword}).then(function(t){e.memberOptions=t.lists})},roleChange:function(){var e=this;this.keyword="","all"===this.roleFilter?s.h(this.roleId,{limit:-1,query:""}).then(function(t){e.memberOptions=t.lists}):s.i(this.roleFilter,{limit:-1,query:""}).then(function(t){e.memberOptions=t.lists})},rightSelectedRender:function(e,t){var i=this.memberOptions.find(function(e){return t.value===e.userId});return e("div",{class:"right-slected"},[e("span",{class:"label",attrs:{title:i.username}},[i.username]),i.account?e("span",{class:"account",attrs:{title:i.account}},["(",i.account,")"]):null,e("i",{class:"gs-icon-close",on:{click:this.unselectOption.bind(this,t)}})])},unselectOption:function(e){var t=this.selected.findIndex(function(t){return t===e.value});this.selected.splice(t,1)}}}},2132:function(e,t,i){"use strict";var s={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("gs-button",{attrs:{type:"primary"},on:{click:e.openAddMemberModal}},[e._v("添加成员")]),e._v(" "),i("gs-button",{attrs:{type:"primary"},on:{click:e.removeMember}},[e._v("移除成员")]),e._v(" "),i("gs-modal",{attrs:{title:"添加成员",width:"680px"},on:{"visible-change":e.visibleChange,confirm:e.addMember},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[i("div",{staticClass:"add-member-modal"},[i("gs-search",{staticClass:"search",on:{search:e.handleSearch,clear:e.handleSearch},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[i("template",{slot:"prepend"},[i("gs-select",{on:{change:e.roleChange},model:{value:e.roleFilter,callback:function(t){e.roleFilter=t},expression:"roleFilter"}},e._l(e.roleOptions,function(e){return i("gs-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId,title:e.roleName}})}),1)],1)],2),e._v(" "),i("gs-modal-select",{staticClass:"searchable-modal-select",attrs:{"right-selected-render":e.rightSelectedRender,flatten:""},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.memberOptions,function(t){return i("gs-option",{key:t.userId,attrs:{label:t.username,value:t.userId,disabled:!!t.status}},[i("span",[e._v(e._s(t.username))]),e._v(" "),i("span",{staticClass:"role-name"},[e._v("("+e._s(t.roleName)+")")])])}),1)],1),e._v(" "),i("gs-loading",{attrs:{"is-show":e.loading}})],1)],1)},staticRenderFns:[]};t.a=s},2133:function(e,t,i){"use strict";var s={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"member"},[i("div",{staticClass:"search-box",class:{"flex-end":"1"===e.roleId}},["1"!==e.roleId?i("add-member",{attrs:{"role-id":e.roleId},on:{removeMember:e.removeMember,addMember:e.addMember}}):e._e(),e._v(" "),i("gs-search",{attrs:{placeholder:"请输入用户名或帐号"},on:{clear:function(t){return e.fetchMemberList(1)},search:e.fetchMemberList},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),e._v(" "),i("data-table",{attrs:{loading:e.loading,"table-props":{data:e.tableData},"pagination-props":e.pagination},on:{"page-change":e.pageChange,"page-size-change":e.sizeChange,"selection-change":e.selectionChange}},[i("el-table-column",{attrs:{type:"selection",fixed:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"account",label:"帐号","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"username",label:"用户名","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"roleName",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.roles,function(t){return i("gs-tag",{key:t},[e._v("\n          "+e._s(t))])})}}])})],1)],1)},staticRenderFns:[]};t.a=s},2134:function(e,t,i){"use strict";var s={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"role-detail"},[i("gs-tabs",{attrs:{type:"content-tab"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("gs-tab-pane",{attrs:{label:"成员",name:"member"}},[i("member")],1),e._v(" "),i("gs-tab-pane",{attrs:{label:"权限",name:"authorize"}},[i("authorize")],1)],1)],1)},staticRenderFns:[]};t.a=s},781:function(e,t,i){"use strict";var s=i(789);t.a=s.a},789:function(e,t,i){"use strict";var s=i(790),n=i(791),a=i(108)(s.a,n.a,null,null,null);t.a=a.exports},790:function(e,t,i){"use strict";t.a={props:{tableProps:{type:Object,default:function(){return{}}},paginationProps:{type:Object,default:function(){return{}}},loading:{type:Boolean,default:!1}},methods:{sortChange:function(e){var t=e.column,i=e.prop,s=e.order;this.$emit("sort-change",{column:t,prop:i,order:s})},handleSelectionChange:function(e){this.$emit("selection-change",e)},pageChange:function(e){this.$emit("page-change",e)},pageSizeChange:function(e){this.$emit("page-size-change",e)},clearSelection:function(){this.$refs.dataTable.clearSelection()},getTable:function(){return this.$refs.dataTable},doLayout:function(){this.$refs.dataTable.doLayout()}}}},791:function(e,t,i){"use strict";var s={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"data-list"},[i("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataTable",on:{"sort-change":e.sortChange,"selection-change":e.handleSelectionChange}},"el-table",e.tableProps,!1),[e._t("default")],2),e._v(" "),i("gs-pagination",e._b({attrs:{"page-sizes":[10,20,30,40,50,100],layout:e.paginationProps.layout||"range,total,pagesizes,pager,jumper,jumpbtn"},on:{"page-change":e.pageChange,"page-size-change":e.pageSizeChange}},"gs-pagination",e.paginationProps,!1))],1)},staticRenderFns:[]};t.a=s},849:function(e,t,i){"use strict";t.k=function(e){return s.a.post("/role/roles",e)},t.f=function(e){return s.a.delete("/role/"+e)},t.j=function(e){return s.a.post("/role/privileges",e)},t.b=function(e){return s.a.post("/role",e)},t.g=function(e){var t=e.params,i=e.roleId;return s.a.put("/role/"+i,t)},t.i=function(e,t){return s.a.post("/role/"+e+"/users",t)},t.e=function(e,t){return s.a.delete("/role/"+e+"/user",{data:t})},t.a=function(e,t){return s.a.post("role/"+e+"/user",t)},t.l=function(e){return s.a.get("/role/"+e+"/privileges")},t.c=function(e){var t=e.params,i=e.roleId;return s.a.put("/role/"+i+"/privileges",t)},t.d=function(e){var t=e.roleId,i=e.status;return s.a.put("/role/"+t+"/"+i)},t.h=function(e,t){return s.a.post("/role/users/"+e,t)};var s=i(780)},923:function(e,t,i){"use strict";t.f=function(e){return s.a.post("/privilege/privileges",e)},t.b=function(e){return s.a.delete("/privilege/"+e)},t.e=function(e){return s.a.get("/privilege/"+e)},t.d=function(){return s.a.get("/privilege/modules")},t.a=function(e){return s.a.post("/privilege",e)},t.c=function(e,t){return s.a.put("/privilege/"+e,t)},t.g=function(e){return s.a.post("/privilege/roles",e)};var s=i(780)}});
//# sourceMappingURL=13.98eece9b.js.map