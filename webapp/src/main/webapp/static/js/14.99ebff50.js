webpackJsonp([14],{2113:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2114),a=i(2122),s=i(107)(n.a,a.a,null,null,null);t.default=s.exports},2114:function(e,t,i){"use strict";var n=i(2115),a=i(2118);t.a={components:{authorize:n.a,member:a.a},data:function(){return{activeName:"member"}}}},2115:function(e,t,i){"use strict";var n=i(2116),a=i(2117),s=i(107)(n.a,a.a,null,null,null);t.a=s.exports},2116:function(e,t,i){"use strict";var n=i(158),a=i.n(n),s=i(781),r=i(855),o=i(916);t.a={data:function(){return{privilege:{privilegeName:"",modules:[]},storePrivilege:{},roleId:"",technicalCategories:[],businessCategories:[],edit:!1,privilegesOptions:[],privilegeId:"",businessCheck:[],technicalCheck:[],loading:!1,allowEdit:!1}},created:function(){this.roleId=this.$route.params.id,this.fetchRolePrivilege()},methods:{fetchRolePrivilege:function(){var e=this;this.loading=!0,r.h({limit:-1,query:""}).then(function(t){e.privilegesOptions=t.lists}),r.j(this.roleId).then(function(t){if(e.allowEdit=!!t.edit,t.technicalCategories&&t.technicalCategories.length){t.technicalCategories.map(function(t){return t.disabled=!t.show,t.status&&e.technicalCheck.push(t.guid),t});var i=Object(s.e)(t.technicalCategories,"guid","parentCategoryGuid"),n=Object(s.f)(i,"guid","upBrotherCategoryGuid","downBrotherCategoryGuid");e.technicalCategories=Object(s.d)(n,!0,"hide",!1)}if(t.businessCategories&&t.businessCategories.length){t.businessCategories.map(function(t){return t.disabled=!t.show,t.status&&e.businessCheck.push(t.guid),t});var r=Object(s.e)(t.businessCategories,"guid","parentCategoryGuid"),o=Object(s.f)(r,"guid","upBrotherCategoryGuid","downBrotherCategoryGuid");e.businessCategories=Object(s.d)(o,!0,"hide",!1)}e.privilegeId=t.privilege.privilegeId,e.privilege=t.privilege,e.storePrivilege=JSON.parse(a()(t.privilege)),e.loading=!1})},renderTree:function(e,t){t.node;var i=t.data,n=this.edit;return i.hide?e("div"):e("span",[n?e("gs-checkbox",{attrs:{value:!!i.status,disabled:!i.show},on:{change:this.categoryChange.bind(this,i)}}):i.status?e("i",{class:"gs-icon-check"}):null,e("span",[i.name])])},filterNode:function(e){return function e(t){return t=t.filter(function(t){return t.children&&(t.children=e(t.children)),!t.hide})}(e)},categoryChange:function(e){e.status=1===e.status?0:1,function e(t,i){t.children&&t.children.map(function(t){return t.children?(t.status=i,e(t,i)):(t.status=i,t)})}(e,e.status)},changePrivilege:function(){var e=this,t={};t.privilege={privilegeId:this.privilegeId,modules:this.privilege.modules};var i=function(e){return function e(t){return function(e){var t;return(t=[]).concat.apply(t,e)}(t.map(function(t){return Array.isArray(t.children)&&0===t.status?[].concat(t,e(t.children)):t}))}(e).filter(function(e){return 1===e.status}).map(function(e){return e.guid})},n=i(this.technicalCategories),a=i(this.businessCategories);n&&n.length&&(t.technicalCategories=n.map(function(e){return{guid:e,status:1}})),a&&a.length&&(t.businessCategories=a.map(function(e){return{guid:e,status:1}})),r.b({params:t,roleId:this.roleId}).then(function(t){e.edit=!1,e.$Message.success("修改成功"),e.fetchRolePrivilege()})},changePrivilegeOption:function(e){var t=this;o.e(e).then(function(e){t.privilege.modules=e.modules})},cancel:function(){this.edit=!1,this.privilege=JSON.parse(a()(this.storePrivilege)),this.privilegeId=this.privilege.privilegeId,this.technicalCategories=JSON.parse(this.copyTechnicalTree),this.businessCategories=JSON.parse(this.copyBusinessTree)},editPrivilege:function(){this.edit=!0,this.copyTechnicalTree=a()(this.technicalCategories),this.copyBusinessTree=a()(this.businessCategories)}}}},2117:function(e,t,i){"use strict";var n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"authorize"},[i("div",{staticClass:"header"},[i("div",{staticClass:"title"},[i("span",{staticClass:"label"},[e._v("权限方案:")]),e._v(" "),e.edit?i("gs-select",{staticClass:"doc-select",attrs:{"popper-class":"searchable-select"},on:{change:e.changePrivilegeOption},model:{value:e.privilegeId,callback:function(t){e.privilegeId=t},expression:"privilegeId"}},e._l(e.privilegesOptions,function(e){return i("gs-option",{key:e.privilegeId,attrs:{label:e.privilegeName,value:e.privilegeId}})}),1):i("span",[e._v(e._s(e.privilege.privilegeName))])],1),e._v(" "),i("div",{staticClass:"operation-box"},[i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.allowEdit&&!e.edit,expression:"allowEdit && !edit"}],attrs:{type:"text-primary"},on:{click:e.editPrivilege}},[e._v("编辑")]),e._v(" "),i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}],attrs:{type:"text-primary"},on:{click:e.changePrivilege}},[e._v("确定")]),e._v(" "),i("gs-button",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}],attrs:{type:"text-primary"},on:{click:e.cancel}},[e._v("取消")])],1)]),e._v(" "),i("div",{staticClass:"wrap"},[i("div",{staticClass:"left"},[i("div",{staticClass:"authorize-module"},[i("div",{staticClass:"title"},[e._v("授权模块")]),e._v(" "),e._l(e.privilege.modules.filter(function(e){return e.type})||[],function(t){return i("p",{key:t.moduleId},[i("i",{staticClass:"gs-icon-check"}),e._v(e._s(t.moduleName)+"\n        ")])})],2),e._v(" "),i("div",{staticClass:"business-obj-ope"},[i("div",{staticClass:"title"},[e._v("管理权限")]),e._v(" "),e._l(e.privilege.modules.filter(function(e){return!e.type})||[],function(t){return i("p",{key:t.moduleId},[i("i",{staticClass:"gs-icon-check"}),e._v(e._s(t.moduleName)+"\n        ")])})],2)]),e._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"title"},[e._v("授权范围")]),e._v(" "),i("div",{staticClass:"wrapper"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.privilege.modules.some(function(e){return 1===e.moduleId}),expression:"privilege.modules.some(item =>item.moduleId === 1)"}],staticClass:"technical"},[i("div",{staticClass:"sub-title"},[e._v("技术目录")]),e._v(" "),i("gs-tree",{ref:"technicalTree",attrs:{data:e.technicalCategories,props:{label:"name",className:"hide"},"render-content":e.renderTree,"node-key":"guid"}})],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.privilege.modules.some(function(e){return[2,5].includes(e.moduleId)}),expression:"privilege.modules.some(item => [2, 5].includes(item.moduleId))"}],staticClass:"bussiness"},[i("div",{staticClass:"sub-title"},[e._v("业务目录")]),e._v(" "),i("gs-tree",{ref:"businessTree",attrs:{data:e.businessCategories,props:{label:"name"},"render-content":e.renderTree,"node-key":"guid"}})],1)])])])])},staticRenderFns:[]};t.a=n},2118:function(e,t,i){"use strict";var n=i(2119),a=i(2121),s=i(107)(n.a,a.a,null,null,null);t.a=s.exports},2119:function(e,t,i){"use strict";var n=i(2120),a=(i.n(n),i(855)),s=i(774);t.a={components:{dataTable:s.a},data:function(){return{keyword:"",tableData:[],pagination:{total:0,pageSize:10,pageSizes:[10,20,30],current:1},loading:!1,selection:[],roleId:""}},computed:{},created:function(){this.roleId=this.$route.params.id,this.fetchMemberList(1)},methods:{fetchMemberList:function(){var e=this;1===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)&&(this.pagination.current=1),this.loading=!0,a.g(this.roleId,{offset:(this.pagination.current-1)*this.pagination.pageSize,limit:this.pagination.pageSize,query:this.keyword}).then(function(t){t.lists.map(function(e){return e.roles=[e.roleName],e}),e.tableData=t.lists,e.pagination.total=t.sum||0,e.loading=!1}).catch(function(t){e.loading=!1})},pageChange:function(e){this.pagination.current=e,this.fetchMemberList()},sizeChange:function(e){this.pagination.pageSize=e,this.fetchMemberList(1)},removeMember:function(){var e=this;if(this.selection.length){var t=this.selection.map(function(e){return e.userId});this.$Modal.confirm({title:"警告",content:"是否删除该成员？删除后将无法恢复",onOk:function(){a.d(e.roleId,t).then(function(t){e.$Message.success("删除成员成功"),e.fetchMemberList()})}})}else this.$Message.warning("请选择成员")},selectionChange:function(e){this.selection=e}}}},2120:function(e,t){},2121:function(e,t,i){"use strict";var n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"member"},[i("div",{staticClass:"search-box",class:{"flex-end":"1"===e.roleId}},[i("gs-search",{attrs:{placeholder:"请输入用户名或帐号"},on:{clear:function(t){return e.fetchMemberList(1)},search:e.fetchMemberList},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),e._v(" "),i("data-table",{attrs:{loading:e.loading,"table-props":{data:e.tableData},"pagination-props":e.pagination},on:{"page-change":e.pageChange,"page-size-change":e.sizeChange,"selection-change":e.selectionChange}},[i("el-table-column",{attrs:{type:"selection",fixed:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"account",label:"帐号","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"username",label:"用户名","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"roleName",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.roles,function(t){return i("gs-tag",{key:t},[e._v("\n          "+e._s(t))])})}}])})],1)],1)},staticRenderFns:[]};t.a=n},2122:function(e,t,i){"use strict";var n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"role-detail"},[i("gs-tabs",{attrs:{type:"content-tab"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("gs-tab-pane",{attrs:{label:"成员",name:"member"}},[i("member")],1),e._v(" "),i("gs-tab-pane",{attrs:{label:"权限",name:"authorize"}},[i("authorize")],1)],1)],1)},staticRenderFns:[]};t.a=n},774:function(e,t,i){"use strict";var n=i(782);t.a=n.a},782:function(e,t,i){"use strict";var n=i(783),a=i(784),s=i(107)(n.a,a.a,null,null,null);t.a=s.exports},783:function(e,t,i){"use strict";t.a={props:{tableProps:{type:Object,default:function(){return{}}},paginationProps:{type:Object,default:function(){return{}}},loading:{type:Boolean,default:!1}},methods:{sortChange:function(e){var t=e.column,i=e.prop,n=e.order;this.$emit("sort-change",{column:t,prop:i,order:n})},handleSelectionChange:function(e){this.$emit("selection-change",e)},pageChange:function(e){this.$emit("page-change",e)},pageSizeChange:function(e){this.$emit("page-size-change",e)},clearSelection:function(){this.$refs.dataTable.clearSelection()},getTable:function(){return this.$refs.dataTable},doLayout:function(){this.$refs.dataTable.doLayout()}}}},784:function(e,t,i){"use strict";var n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"data-list"},[i("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataTable",on:{"sort-change":e.sortChange,"selection-change":e.handleSelectionChange}},"el-table",e.tableProps,!1),[e._t("default")],2),e._v(" "),i("gs-pagination",e._b({attrs:{"page-sizes":[10,20,30,40,50,100],layout:e.paginationProps.layout||"range,total,pagesizes,pager,jumper,jumpbtn"},on:{"page-change":e.pageChange,"page-size-change":e.pageSizeChange}},"gs-pagination",e.paginationProps,!1))],1)},staticRenderFns:[]};t.a=n},855:function(e,t,i){"use strict";t.i=function(e){return n.a.post("/role/roles",e)},t.e=function(e){return n.a.delete("/role/"+e)},t.h=function(e){return n.a.post("/role/privileges",e)},t.a=function(e){return n.a.post("/role",e)},t.f=function(e){var t=e.params,i=e.roleId;return n.a.put("/role/"+i,t)},t.g=function(e,t){return n.a.post("/role/"+e+"/users",t)},t.d=function(e,t){return n.a.delete("/role/"+e+"/user",{data:t})},t.j=function(e){return n.a.get("/role/"+e+"/privileges")},t.b=function(e){var t=e.params,i=e.roleId;return n.a.put("/role/"+i+"/privileges",t)},t.c=function(e){var t=e.roleId,i=e.status;return n.a.put("/role/"+t+"/"+i)};var n=i(773)},916:function(e,t,i){"use strict";t.f=function(e){return n.a.post("/privilege/privileges",e)},t.b=function(e){return n.a.delete("/privilege/"+e)},t.e=function(e){return n.a.get("/privilege/"+e)},t.d=function(){return n.a.get("/privilege/modules")},t.a=function(e){return n.a.post("/privilege",e)},t.c=function(e,t){return n.a.put("/privilege/"+e,t)},t.g=function(e){return n.a.post("/privilege/roles",e)};var n=i(773)}});
//# sourceMappingURL=14.99ebff50.js.map