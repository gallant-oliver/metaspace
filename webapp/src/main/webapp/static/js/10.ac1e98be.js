webpackJsonp([10],{2148:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(2149),i=a(2166),s=a(107)(n.a,i.a,null,null,null);e.default=s.exports},2149:function(t,e,a){"use strict";var n=a(158),i=a.n(n),s=a(2150),o=(a.n(s),a(2151)),l=a(2154),r=a(2157),u=a(2163),c=a(794),d=a(875),m=["选择数据源","基本信息","API配置信息","测试"];e.a={components:{dataSource:o.a,baseInfo:l.a,apiConfig:r.a,apiTest:u.a},mixins:[d.a],data:function(){return{activeStep:0,stepsTitle:m,components:["dataSource","baseInfo","apiConfig","apiTest"],isEdit:!1,apiData:null,allDone:!1,loading:!1}},computed:{component:function(){return this.components[this.activeStep]},hasData:function(){return!this.$route.query.apiId||null!==this.apiData}},created:function(){this.fetchApiDetail()},methods:{handleNext:function(){var t=this;if(this.activeStep<3)this.activeStep=this.activeStep+1;else{var e=JSON.parse(i()(this.storeApiMsg));delete e.column;var a=this.$route.query,n=a.isEdit,s=a.apiId;this.loading=!0,n&&s?c.editApi({params:e,apiId:s}).then(function(e){t.$Message.success("修改成功"),t.allDone=!0,t.loading=!1,t.$router.push({name:"/main/data-share",query:{groupId:t.$route.query.groupId}})}).catch(function(e){t.loading=!1}):c.createApi(e).then(function(e){t.allDone=!0,t.loading=!1,t.$Message.success("创建成功"),t.$router.push({name:"/main/data-share",query:{groupId:t.$route.query.groupId}})}).catch(function(e){t.loading=!1})}},handlePrev:function(){this.activeStep=this.activeStep-1},fetchApiDetail:function(){var t=this;this.$route.query.apiId&&c.getApiDetail(this.$route.query.apiId).then(function(e){t.apiData=e})},returnList:function(){this.$router.push({path:"/main/data-share/list",query:{groupId:this.$route.query.groupId}})}}}},2150:function(t,e){},2151:function(t,e,a){"use strict";var n=a(2152),i=a(2153),s=a(107)(n.a,i.a,null,null,null);e.a=s.exports},2152:function(t,e,a){"use strict";var n=a(65),i=a.n(n),s=a(32),o=a.n(s),l=a(875),r=a(794);e.a={mixins:[l.a],props:{data:{type:Object,default:function(){return{}}}},data:function(){return{form:{dbGuid:"",tableGuid:"",column:[],maxRowNumber:10},loading:!1,tableOptions:[],databaseOptions:[],columnOptions:[],columnLoading:!1,tableLoading:!1,rules:{dbGuid:[{required:!0,trigger:"change",message:"请选择数据库"}],tableGuid:[{required:!0,trigger:"change",message:"请选择数据表"}],column:[{required:!0,trigger:"change",message:"请选择字段",type:"array"}],maxRowNumber:[{required:!0,trigger:"blur",validator:function(t,e,a){""===e&&a(new Error("请填写最大结果行数")),e&&/\d/.test(e)?a():a(new Error("最大结果行数必须为数字且不能为0"))}}]},isIndeterminate:!1,checkAll:!1}},watch:{"form.tableGuid":{handler:function(t){var e=this;t&&(this.form.column=[],this.$nextTick(function(t){e.$refs.form.clearValidate("column")}),this.fetchColumn())}}},created:function(){var t=this;this.fetchDatabase().then(function(e){t.data&&o()(t.data).length&&t.setData()})},methods:{setData:function(){var t=this,e=this.data,a=e.dbGuid,n=e.tableGuid,i=e.maxRowNumber,s=e.fields.map(function(t){return t.columnName});this.form={dbGuid:a,tableGuid:n,maxRowNumber:i,column:[]},this.$nextTick(function(e){t.$refs.form.clearValidate("column")});var o=this.databaseOptions.find(function(e){return e.databaseId===t.form.dbGuid});o||(this.form.dbGuid="",this.form.tableGuid="",this.$Message.warning("无该库权限")),this.tableSelectVisibleChange(!0),o&&this.fetchColumn().then(function(e){t.$nextTick(function(e){t.form.column=s})})},fetchDatabase:function(){var t=this;return this.loading=!0,r.getDataBase({offset:0,limit:-1,query:""}).then(function(e){t.databaseOptions=e.lists,t.loading=!1})},fetchTable:function(){var t=this;return this.tableLoading=!0,r.getTable({dbGuid:this.form.dbGuid,offset:0,limit:-1,query:""}).then(function(e){t.tableOptions=e.lists,t.tableLoading=!1,t.tableOptions.find(function(e){return e.tableGuid===t.form.tableGuid})||(t.form.tableGuid="")})},fetchColumn:function(){var t=this;return this.columnLoading=!0,r.getColumn(this.form.tableGuid).then(function(e){return t.columnOptions=e,t.columnLoading=!1,e})},tableSelectVisibleChange:function(t){t&&(this.form.dbGuid?(this.fetchTable(),this.handleCheckedColumnChange([])):this.$refs.form.validateField("dbGuid"))},rightSelectedRender:function(t,e){var a=this.columnOptions.find(function(t){return e.value===t.columnName});return t("div",[t("span",{class:"label",attrs:{title:a.columnName}},[a.columnName]),t("span",{class:"desc",attrs:{title:a.description}},[a.description||"-"]),t("i",{class:"gs-icon-close",on:{click:this.unselectOption.bind(this,e)}})])},unselectOption:function(t){var e=this.form.column.findIndex(function(e){return e===t.value});this.form.column.splice(e,1)},handleNext:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.saveApiMsg(i()({},t.form,{column:t.columnOptions.filter(function(e){return t.form.column.includes(e.columnName)})})),t.$emit("next"))})},dbSelectChange:function(){this.form.tableGuid="",this.form.column=[],this.columnOptions=[]},handleCheckAllChange:function(t){this.form.column=t.target.checked?this.columnOptions.map(function(t){return t.columnName}):[],this.isIndeterminate=!1},handleCheckedColumnChange:function(t){var e=t.length;this.checkAll=e>0,this.isIndeterminate=e>0&&e<this.columnOptions.length}}}},2153:function(t,e,a){"use strict";var n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"data-source"},[a("gs-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-position":"top"}},[a("gs-form-item",{attrs:{label:"数据库",prop:"dbGuid"}},[a("gs-select",{attrs:{disabled:t.columnLoading||t.tableLoading,searchable:""},on:{change:t.dbSelectChange},model:{value:t.form.dbGuid,callback:function(e){t.$set(t.form,"dbGuid",e)},expression:"form.dbGuid"}},t._l(t.databaseOptions,function(t){return a("gs-option",{key:t.databaseId,attrs:{label:t.databaseName,value:t.databaseId}})}),1)],1),t._v(" "),a("gs-form-item",{attrs:{label:"数据表",prop:"tableGuid"}},[a("gs-select",{attrs:{disabled:t.columnLoading,searchable:""},on:{"visible-change":t.tableSelectVisibleChange},model:{value:t.form.tableGuid,callback:function(e){t.$set(t.form,"tableGuid",e)},expression:"form.tableGuid"}},t._l(t.tableOptions,function(t){return a("gs-option",{key:t.tableGuid,attrs:{label:t.tableName,value:t.tableGuid}})}),1)],1),t._v(" "),a("gs-form-item",{attrs:{label:"最大结果行数",prop:"maxRowNumber"}},[a("gs-input-number",{attrs:{min:1,max:2e3},model:{value:t.form.maxRowNumber,callback:function(e){t.$set(t.form,"maxRowNumber",e)},expression:"form.maxRowNumber"}})],1),t._v(" "),a("gs-form-item",{attrs:{label:"字段",prop:"column"}},[a("div",{staticClass:"column"},[a("gs-modal-select",{attrs:{loading:t.columnLoading,"right-selected-render":t.rightSelectedRender,flatten:""},on:{change:t.handleCheckedColumnChange},model:{value:t.form.column,callback:function(e){t.$set(t.form,"column",e)},expression:"form.column"}},t._l(t.columnOptions,function(t){return a("gs-option",{key:t.columnId,attrs:{label:t.columnName,value:t.columnName,desc:t.columnId}})}),1),t._v(" "),a("div",{staticClass:"line"}),t._v(" "),a("div",{staticClass:"desc-label"},[t._v("描述")])],1)])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.columnOptions&&t.columnOptions.length,expression:"columnOptions && columnOptions.length"}],staticClass:"choose-all-fileds"},[a("gs-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")])],1),t._v(" "),a("div",{staticClass:"operation"},[a("gs-button",{attrs:{type:"primary"},on:{click:t.handleNext}},[t._v("下一步")])],1)],1)},staticRenderFns:[]};e.a=n},2154:function(t,e,a){"use strict";var n=a(2155),i=a(2156),s=a(107)(n.a,i.a,null,null,null);e.a=s.exports},2155:function(t,e,a){"use strict";var n=a(32),i=a.n(n),s=a(65),o=a.n(s),l=a(875),r=a(794),u=a(772);e.a={mixins:[l.a],props:{data:{type:Object,default:function(){return{}}}},data:function(){return{form:{name:"",groupGuid:"",version:1,description:"",path:"",returnType:"JSON | XML",protocol:"HTTP",requestMode:"POST"},getRandString:(new Date).getTime().toString(36),rules:{name:[{required:!0,trigger:"blur",message:"请填写API名称"}],groupGuid:[{required:!0,trigger:"change",message:"请选择API分组"}],version:[{required:!0,trigger:"blur",message:"请填写API版本",type:"number"}]}}},computed:o()({},Object(u.c)("datashare",["sourceGroupTree"]),{groupOptions:{set:function(t){return t},get:function(){if(this.sourceGroupTree.length)return this.sourceGroupTree.filter(function(t){return t.parentGuid})}}}),watch:{"form.version":{handler:function(t){if(this.$route.query.isEdit){var e=this.data.path.split("/").reverse()[0];this.form.path="/api/v"+t+"/share/"+e}else this.form.path="/api/v"+t+"/share/"+this.getRandString},immediate:!0}},created:function(){this.fetchGroupList(),this.data&&i()(this.data).length&&this.setData()},methods:{setData:function(){var t=this.data,e=t.name,a=t.groupGuid,n=t.protocol,i=t.requestMode,s=t.returnType,l=t.version,r=t.description;this.form=o()({},this.form,{name:this.$route.query.isEdit?e:"",groupGuid:a,version:Number(l),description:r,returnType:s,protocol:n,requestMode:i})},fetchGroupList:function(){var t=this;this.loading=!0,this.sourceGroupTree&&this.sourceGroupTree.length?(this.groupOptions=this.sourceGroupTree.filter(function(t){return t.parentGuid}),this.loading=!1):r.getGroupList().then(function(e){t.groupOptions=e.filter(function(t){return t.parentGuid}),t.loading=!1})},handleBack:function(){this.$emit("back")},handleNext:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.data&&i()(t.data).length&&t.form.name===t.data.name&&t.$route.query.isEdit?(t.saveApiMsg(t.form),t.$emit("next")):r.checkName({name:t.form.name}).then(function(e){e?t.$Message.error("已存在该名称"):(t.saveApiMsg(t.form),t.$emit("next"))}))})}}}},2156:function(t,e,a){"use strict";var n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"base-info"},[a("gs-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-position":"top"}},[a("gs-form-item",{attrs:{label:"API名称",prop:"name"}},[a("gs-input",{attrs:{placeholder:"请填写API名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("gs-form-item",{attrs:{label:"API分组",prop:"groupGuid"}},[a("gs-select",{attrs:{placeholder:"请选择API分组",searchable:""},model:{value:t.form.groupGuid,callback:function(e){t.$set(t.form,"groupGuid",e)},expression:"form.groupGuid"}},t._l(t.groupOptions,function(t){return a("gs-option",{key:t.guid,attrs:{label:t.name,value:t.guid}})}),1)],1),t._v(" "),a("gs-form-item",{attrs:{label:"版本",prop:"version"}},[a("gs-input-number",{attrs:{min:0,placeholder:"请填写API版本"},model:{value:t.form.version,callback:function(e){t.$set(t.form,"version",e)},expression:"form.version"}})],1),t._v(" "),a("gs-form-item",{attrs:{label:"描述",prop:"description"}},[a("gs-textarea",{attrs:{placeholder:"请填写描述信息"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),t._v(" "),a("div",{staticClass:"info"},[a("div",[a("span",[t._v("协议类型")]),t._v(" "),a("span",[t._v(t._s(t.form.protocol))])]),t._v(" "),a("div",[a("span",[t._v("请求方式")]),t._v(" "),a("span",[t._v(t._s(t.form.requestMode))])]),t._v(" "),a("div",[a("span",[t._v("返回类型")]),t._v(" "),a("span",[t._v(t._s(t.form.returnType))])]),t._v(" "),a("div",[a("span",[t._v("API路径")]),t._v(" "),a("span",[t._v(t._s(t.form.path))])])]),t._v(" "),a("div",{staticClass:"operation"},[a("gs-button",{on:{click:t.handleBack}},[t._v("上一步")]),t._v(" "),a("gs-button",{attrs:{type:"primary"},on:{click:t.handleNext}},[t._v("下一步")])],1)],1)},staticRenderFns:[]};e.a=n},2157:function(t,e,a){"use strict";var n=a(2158),i=a(2162),s=a(107)(n.a,i.a,null,null,null);e.a=s.exports},2158:function(t,e,a){"use strict";var n=a(32),i=a.n(n),s=a(158),o=a.n(s),l=a(875),r=a(2159);e.a={components:{addDefaultValue:r.a},mixins:[l.a],props:{data:{type:Object,default:function(){return{}}}},data:function(){return{fields:[],form:{},modalVisible:!1,editIndex:-1,isIndeterminate:!1,checkAll:!1}},computed:{fieldsName:function(){return this.fields.map(function(t){return t.columnName})}},watch:{"storeApiMsg.column":{handler:function(t,e){o()(t)===o()(e)||(this.fields=[],this.changeCheckAllStatus())},deep:!0}},created:function(){this.data&&i()(this.data).length&&this.setData()},methods:{setData:function(){var t=this.storeApiMsg.column.map(function(t){return t.columnName});this.fields=(this.data.fields||[]).filter(function(e){return e.filter&&t.includes(e.columnName)}),this.changeCheckAllStatus()},handleNext:function(){var t=this,e=[];this.storeApiMsg.column.map(function(a){t.fieldsName.includes(a.columnName)||e.push({columnName:a.columnName,filter:!1,type:a.type})}),this.saveApiMsg({fields:[].concat(e,this.fields)}),this.$emit("next")},handleBack:function(){this.$emit("back")},chooseFields:function(t){this.fieldsName.includes(t.columnName)||(this.fields.push({columnName:t.columnName,filter:!0,fill:!1,defaultValue:"",type:t.type,useDefaultValue:!1}),this.changeCheckAllStatus())},deleteField:function(t,e){var a=this.fields.findIndex(function(e){return t===e.columnName});-1!==a&&(this.fields.splice(a,1),this.changeCheckAllStatus())},editFilterField:function(t){this.modalVisible=!0,this.form=JSON.parse(o()(t.row)),this.editIndex=t.$index},confirmEditField:function(t){this.$set(this.fields,this.editIndex,t),this.modalVisible=!1},handleCheckAllChange:function(t){this.fields=t.target.checked?this.storeApiMsg.column.map(function(t){return{columnName:t.columnName,filter:!0,fill:!1,defaultValue:"",type:t.type,useDefaultValue:!1}}):[],this.isIndeterminate=!1},changeCheckAllStatus:function(){var t=this.fields.length;this.checkAll=t>0,this.isIndeterminate=t>0&&t<this.storeApiMsg.column.length}}}},2159:function(t,e,a){"use strict";var n=a(2160),i=a(2161),s=a(107)(n.a,i.a,null,null,null);e.a=s.exports},2160:function(t,e,a){"use strict";var n=a(830);e.a={components:{fieldsInput:n.a},props:{show:{type:Boolean,default:!1},data:{type:Object,default:function(){}}},data:function(){return{modalVisible:!1,form:{}}},watch:{data:function(t){this.form=t},show:function(t){this.modalVisible=t}},methods:{confirmEditField:function(){this.$emit("confirm",this.form)},cancel:function(){this.$emit("update:show",!1)},useDefaultValueChange:function(t){t||(this.form.defaultValue="")}}}},2161:function(t,e,a){"use strict";var n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("gs-modal",{attrs:{title:"过滤条件字段"},on:{confirm:t.confirmEditField,cancel:t.cancel},model:{value:t.modalVisible,callback:function(e){t.modalVisible=e},expression:"modalVisible"}},[a("gs-form",{attrs:{model:t.form,"label-width":"120px"}},[a("gs-form-item",{attrs:{label:"字段名称",prop:"columnName"}},[a("span",[t._v(t._s(t.form.columnName))])]),t._v(" "),a("gs-form-item",{attrs:{label:"字段类型",prop:"type"}},[a("span",[t._v(t._s(t.form.type))])]),t._v(" "),a("gs-form-item",{attrs:{label:"必传",prop:"fill"}},[a("gs-radio-group",{model:{value:t.form.fill,callback:function(e){t.$set(t.form,"fill",e)},expression:"form.fill"}},[a("gs-radio",{attrs:{label:!0}},[t._v("是")]),t._v(" "),a("gs-radio",{attrs:{label:!1}},[t._v("否")])],1)],1),t._v(" "),t.form.fill?t._e():a("gs-form-item",{attrs:{label:"是否有缺省默认值",prop:"useDefaultValue"}},[a("gs-radio-group",{on:{change:t.useDefaultValueChange},model:{value:t.form.useDefaultValue,callback:function(e){t.$set(t.form,"useDefaultValue",e)},expression:"form.useDefaultValue"}},[a("gs-radio",{attrs:{label:!0}},[t._v("是")]),t._v(" "),a("gs-radio",{attrs:{label:!1}},[t._v("否")])],1)],1),t._v(" "),t.form.fill?t._e():a("gs-form-item",{attrs:{label:"默认值",prop:"defaultValue"}},[a("fields-input",{attrs:{type:t.form.type,disabled:!t.form.useDefaultValue},model:{value:t.form.defaultValue,callback:function(e){t.$set(t.form,"defaultValue",e)},expression:"form.defaultValue"}})],1)],1)],1)},staticRenderFns:[]};e.a=n},2162:function(t,e,a){"use strict";var n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"api-config"},[a("div",{staticClass:"content"},[a("div",{staticClass:"all-fileds"},[a("div",{staticClass:"all-fileds-header"},[a("h4",{staticClass:"title"},[t._v("\n          已选字段\n        ")]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.storeApiMsg.column&&t.storeApiMsg.column.length,expression:"storeApiMsg.column && storeApiMsg.column.length"}],staticClass:"choose-all-fileds"},[a("gs-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")])],1)]),t._v(" "),a("ul",{staticClass:"container"},t._l(t.storeApiMsg.column||[],function(e,n){return a("li",{key:n,class:t.fieldsName.includes(e.columnName)?"active":"",on:{click:function(a){return t.chooseFields(e)}}},[t.fieldsName.includes(e.columnName)?a("i",{staticClass:"gs-icon-check"}):t._e(),t._v(" "),a("span",[t._v(t._s(e.columnName))]),t._v(" "),a("i",{staticClass:"gs-icon-close",on:{click:function(a){return a.stopPropagation(),t.deleteField(e.columnName,n)}}})])}),0)]),t._v(" "),a("div",{staticClass:"filter-fileds"},[a("h4",{staticClass:"title"},[t._v("\n        过滤条件字段\n      ")]),t._v(" "),a("div",{staticClass:"container"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.fields}},[a("el-table-column",{attrs:{prop:"columnName",label:"名称","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"fill",label:"必传","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.fill?"是":"否"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"type",label:"类型","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"defaultValue",label:"默认值","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.defaultValue||"无"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[a("gs-button",{attrs:{type:"text-primary"},on:{click:function(a){return t.editFilterField(e)}}},[t._v("编辑")]),t._v(" "),a("gs-button",{attrs:{type:"text-primary"},on:{click:function(a){return t.deleteField(e.row.columnName)}}},[t._v("删除")])],1)]}}])})],1)],1)])]),t._v(" "),a("div",{staticClass:"operation"},[a("gs-button",{on:{click:t.handleBack}},[t._v("上一步")]),t._v(" "),a("gs-button",{attrs:{type:"primary"},on:{click:t.handleNext}},[t._v("下一步")])],1),t._v(" "),a("add-default-value",{attrs:{show:t.modalVisible,data:t.form},on:{"update:show":function(e){t.modalVisible=e},confirm:t.confirmEditField}})],1)},staticRenderFns:[]};e.a=n},2163:function(t,e,a){"use strict";var n=a(2164),i=a(2165),s=a(107)(n.a,i.a,null,null,null);e.a=s.exports},2164:function(t,e,a){"use strict";var n=a(875),i=a(841),s=a(794),o=a(831),l=a.n(o),r=a(830),u=Math.random().toString(36).slice(-8);e.a={components:{fieldsInput:r.a},mixins:[n.a,i.a],data:function(){return{}},computed:{},activated:function(){var t=this;this.testData=(this.storeApiMsg.fields||[]).filter(function(t){return t.filter}).map(function(e){var a=(t.storeApiMsg.column||[]).find(function(t){return t.columnName===e.columnName});return{columnName:e.columnName,value:e.defaultValue||"",check:!0,type:a.type,fill:e.fill}})},methods:{handleNext:function(){this.$emit("next")},handleBack:function(){this.$emit("back")},startTest:function(){var t=this;if(this.checkTestInput()){var e=this.storeApiMsg,a={tableGuid:e.tableGuid,dbGuid:e.dbGuid,maxRowNumber:e.maxRowNumber,parameter:this.testData.filter(function(e){var a=(t.storeApiMsg.fields||[]).find(function(t){return t.columnName===e.columnName});return e.check||!e.fill&&""!==a.defaultValue}).map(function(t){return{columnName:t.columnName,value:[t.value]}}),queryFields:this.storeApiMsg.column.map(function(t){return t.columnName}),limit:this.limit,offset:this.offset};u=Math.random().toString(36).slice(-8),this.btnLoading=!0;var n=l.a.CancelToken;this.source=n.source(),s.testApi({params:a,randomName:u},this.source.token).then(function(e){t.testRes=e,t.btnLoading=!1,t.$Message.success("测试完成！")}).catch(function(e){t.btnLoading=!1})}}}}},2165:function(t,e,a){"use strict";var n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"test-api"},[a("div",{staticClass:"content"},[a("p",{staticClass:"title"},[a("span",[t._v("API地址")]),t._v(" "),a("span",{staticClass:"path"},[t._v(t._s(t.storeApiMsg.path))])]),t._v(" "),a("div",{staticClass:"req-msg"},[a("h5",{staticClass:"title"},[t._v("请求信息")]),t._v(" "),a("div",{staticClass:"request"},[t._l(t.testData,function(e,n){return a("div",{key:n,staticClass:"fields"},[a("gs-checkbox",{staticClass:"name",model:{value:e.check,callback:function(a){t.$set(e,"check",a)},expression:"item.check"}},[a("span",{attrs:{title:e.columnName}},[t._v(t._s(e.columnName))])]),t._v(" "),a("span",[t._v("=")]),t._v(" "),a("span",{staticClass:"value"},[a("fields-input",{attrs:{type:e.type},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"item.value"}})],1)],1)}),t._v(" "),a("div",{staticClass:"fields"},[a("span",{staticClass:"name"},[t._v("limit")]),t._v(" "),a("span",[t._v("=")]),t._v(" "),a("span",{staticClass:"value"},[a("gs-input-number",{attrs:{precision:0,min:0,max:100},model:{value:t.limit,callback:function(e){t.limit=e},expression:"limit"}})],1)]),t._v(" "),a("div",{staticClass:"fields"},[a("span",{staticClass:"name"},[t._v("offset")]),t._v(" "),a("span",[t._v("=")]),t._v(" "),a("span",{staticClass:"value"},[a("gs-input-number",{attrs:{precision:0,min:0},model:{value:t.offset,callback:function(e){t.offset=e},expression:"offset"}})],1)])],2),t._v(" "),a("div",{staticClass:"test-operation"},[a("gs-button",{attrs:{disabled:!t.btnLoading},on:{click:t.stopTest}},[t._v("停止测试")]),t._v(" "),a("gs-button",{attrs:{loading:t.btnLoading,type:"primary"},on:{click:t.startTest}},[t._v("开始测试")])],1)]),t._v(" "),a("div",{staticClass:"rep-res"},[a("div",{staticClass:"response"},[a("gs-tabs",{attrs:{type:"content-tab"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("gs-tab-pane",{attrs:{label:"编码模式",name:"json"}},[a("gs-textarea",{attrs:{value:t.testResStringify,autosize:{minRows:8,maxRows:12},readonly:""}})],1),t._v(" "),a("gs-tab-pane",{attrs:{label:"表格模式",name:"table"}},[a("el-table",{attrs:{data:t.testRes}},t._l(t.tableHeader,function(e,n){return a("el-table-column",{key:n,attrs:{label:e,prop:e},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v("\n                  "+t._s(a.row[e]+"")+"\n                ")]}}],null,!0)})}),1)],1)],1)],1)])]),t._v(" "),a("div",{staticClass:"operation"},[a("gs-button",{on:{click:t.handleBack}},[t._v("上一步")]),t._v(" "),a("gs-button",{attrs:{type:"primary"},on:{click:t.handleNext}},[t._v("完成")])],1)])},staticRenderFns:[]};e.a=n},2166:function(t,e,a){"use strict";var n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"create-api"},[a("gs-button",{staticClass:"revoke",attrs:{type:"primary",icon:"revoke"},on:{click:t.returnList}}),t._v(" "),a("gs-steps",{attrs:{active:t.activeStep,"align-center":"",space:"160px",size:"small"}},[a("template",{slot:"header"},t._l(t.stepsTitle,function(t,e){return a("gs-step",{key:e,attrs:{title:t}})}),1),t._v(" "),a("template",{slot:"content"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"steps-content"},[a("transition",{attrs:{name:"fade-transform-right",mode:"out-in"}},[a("keep-alive",[t.hasData?a(t.component,{tag:"component",attrs:{"is-edit":t.isEdit,data:t.apiData,"active-step":t.activeStep},on:{next:t.handleNext,back:t.handlePrev}}):t._e()],1)],1)],1)])],2)],1)},staticRenderFns:[]};e.a=n},830:function(t,e,a){"use strict";var n=a(839),i=a(840);var s=function(t){a(838)},o=a(107)(n.a,i.a,s,null,null);e.a=o.exports},838:function(t,e){},839:function(t,e,a){"use strict";var n=a(916),i=a.n(n),s=a(1),o=a.n(s),l=a(781);e.a={name:"FieldsInput",props:{value:{type:[String,Number,Object,Array,Boolean],default:""},disabled:{type:Boolean,default:!1},type:{type:String,default:""}},data:function(){return{numberType:l.b}},computed:{isNumber:function(){var t=this;return this.numberType.some(function(e){return t.type.startsWith(e)})},valueCache:function(){return"timestamp"===this.type&&""!==this.value?o()(this.value):this.value}},methods:{change:function(t){var e="";e="timestamp"===this.type?t.valueOf():this.isNumber&&i()(parseFloat(t))?parseFloat(t):t,this.$emit("input",e)}}}},840:function(t,e,a){"use strict";var n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return"timestamp"===t.type?a("gs-date-picker",{attrs:{value:t.valueCache,disabled:t.disabled,type:"date-time"},on:{change:t.change}}):"boolean"===t.type?a("gs-radio-group",{attrs:{value:t.valueCache,disabled:t.disabled},on:{change:t.change}},[a("gs-radio",{attrs:{label:!0}}),t._v(" "),a("gs-radio",{attrs:{label:!1}})],1):a("gs-input",{staticClass:"fileds-input",attrs:{placeholder:t.isNumber?"请输入数字":"",value:t.valueCache,disabled:t.disabled},on:{change:t.change}})},staticRenderFns:[]};e.a=n},841:function(t,e,a){"use strict";var n=a(158),i=a.n(n),s=a(32),o=a.n(s),l=a(794),r=a(831),u=a.n(r),c=a(781),d=Math.random().toString(36).slice(-8);e.a={data:function(){return{testData:[],limit:10,offset:0,btnLoading:!1,activeName:"json",testRes:[],numberType:c.b}},computed:{tableHeader:function(){var t=this.testRes;return t&&t[0]?o()(t[0]):[]},testResStringify:function(){return i()(this.testRes,null,4)}},methods:{checkTestInput:function(){var t=this;if(""===this.offset||""===this.limit)return this.$Message.error("请填入limit和offset参数。"),!1;var e=this.testData.filter(function(t){return t.fill&&!t.check});if(e&&e.length){var a=e.map(function(t){return t.columnName}).join(",");return this.$Message.error(a+"字段为必填字段，请选中并输入数据"),!1}var n=this.testData.filter(function(t){return t.check}).filter(function(e){return!!(t.numberType.includes(e.type)&&""===e.value||"timestamp"===e.type&&""===e.value||"boolean"===e.type&&""===e.value)}).map(function(t){return t.columnName}).join(",");return!n||(this.$Message.error(n+"字段缺少过滤值内容，请输入"),!1)},stopTest:function(){var t=this;this.source.cancel(),l.stopTestApi(d).then(function(e){t.$Message.success("停止成功")})},startTest:function(){var t=this;if(this.checkTestInput()){var e=this.detailData,a={tableGuid:e.tableGuid,dbGuid:e.dbGuid,maxRowNumber:e.maxRowNumber,parameter:this.testData.filter(function(t){return t.check}).map(function(t){return"timestamp"===t.type&&t.value?{columnName:t.columnName,value:[t.value.unix()]}:{columnName:t.columnName,value:[t.value]}}),queryFields:this.detailData.fields.map(function(t){return t.columnName}),limit:this.limit,offset:this.offset};d=Math.random().toString(36).slice(-8),this.btnLoading=!0;var n=u.a.CancelToken;this.source=n.source(),l.testApi({params:a,randomName:d},this.source.token).then(function(e){t.testRes=e,t.btnLoading=!1,t.$Message.success("测试完成！")}).catch(function(e){t.btnLoading=!1})}}}}},875:function(t,e,a){"use strict";var n=a(65),i=a.n(n),s=a(772);e.a={computed:i()({},Object(s.c)("datashare",["storeApiMsg"])),methods:i()({},Object(s.b)("datashare",["saveApiMsg"]))}}});
//# sourceMappingURL=10.ac1e98be.js.map