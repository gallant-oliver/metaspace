webpackJsonp([18],{2142:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e(2143),s=e(2145),n=e(108)(i.a,s.a,null,null,null);a.default=n.exports},2143:function(t,a,e){"use strict";var i=e(162),s=e.n(i),n=e(65),l=e.n(n),r=e(779),c=e(783),o=e(837),u=e(778),d=e(2144),v=(e.n(d),e(848));a.a={components:{BreadCrumb:c.a,fieldsInput:o.a},mixins:[v.a],data:function(){return{apiId:"",activeTab:"info"}},computed:l()({},Object(r.c)("datashare",{apiDetail:"apiDetail"}),{detailData:function(){return this.apiDetail.data||{}},apiTableData:function(){return this.detailData.fields||[]},dataOwners:function(){return(this.detailData.dataOwner||[]).join("，")||"-"},isDetailLoading:function(){return Object(u.d)(this.apiDetail.status)}}),mounted:function(){var t=this,a=(this.$route.params||{}).id;this.apiId=a,a&&this.getApiDetail(a).then(function(a){t.testData=(t.detailData.fields||[]).filter(function(t){return t.filter}).map(function(t){return{columnName:t.columnName,value:"",check:!0,type:t.type,fill:t.fill}})})},methods:l()({},Object(r.b)("datashare",["getApiDetail","delApi","unPublishApi"]),{deleteApi:function(){var t=this;this.$Modal.confirm({title:"提示",content:"确定删除该API吗？",onOk:function(){t.delApi(t.apiId).then(function(a){t.$Message.success("删除成功"),t.$router.push("/main/data-share")})}})},publish:function(){localStorage&&localStorage.setItem("SELECTED_API",s()([this.detailData])),this.$router.push("/main/data-share/publish")},unPublish:function(){var t=this;this.$Modal.confirm({title:"提示",content:"确定撤销发布该API吗？",onOk:function(){t.unPublishApi([t.apiId]).then(function(a){t.$Message.success("撤销成功"),t.getApiDetail(t.apiId)})}})},copyApi:function(){this.$router.push({name:"/main/data-share/create",query:{apiId:this.apiId}})},editApi:function(){this.$router.push({name:"/main/data-share/create",query:{apiId:this.apiId,isEdit:!0}})}})}},2144:function(t,a){},2145:function(t,a,e){"use strict";var i={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"api-detail-page"},[e("div",{staticClass:"content-header"},[e("bread-crumb",{attrs:{"current-level":"API详情","upper-level":"数据分享","back-path":"/main/data-share"}})],1),t._v(" "),e("div",{staticClass:"api-detail-body"},[e("gs-loading",{attrs:{"is-show":t.isDetailLoading}}),t._v(" "),e("div",{staticClass:"api-base-info"},[e("div",{staticClass:"info-text"},[e("div",{staticClass:"api-name"},[t._v("\n          "+t._s(t.detailData.name||"-")+"\n          "),e("span",{class:{"status-label":!0,"status-published":t.detailData.publish}},[t._v(t._s(t.detailData.publish?"已发布":"未发布"))])]),t._v(" "),e("div",{staticClass:"info-item"},[e("div",{staticClass:"info-item-text"},[t._v("\n            创建人："+t._s(t.detailData.keeper||"-")+"\n          ")]),t._v(" "),e("div",{staticClass:"info-item-text"},[t._v("\n            创建时间："+t._s(t.detailData.generateTime||"-")+"\n          ")]),t._v(" "),e("div",{staticClass:"info-item-text"},[t._v("\n            修改人："+t._s(t.detailData.updater||"-")+"\n          ")]),t._v(" "),e("div",{staticClass:"info-item-text"},[t._v("\n            修改时间："+t._s(t.detailData.updateTime||"-")+"\n          ")])])]),t._v(" "),e("div",{staticClass:"action-group"},[t.detailData.edit&&!t.detailData.publish?e("gs-button",{attrs:{type:"text-primary"},on:{click:t.publish}},[t._v("发布")]):t._e(),t._v(" "),t.detailData.edit&&t.detailData.publish?e("gs-button",{attrs:{type:"text-primary"},on:{click:t.unPublish}},[t._v("撤销发布")]):t._e(),t._v(" "),e("gs-button",{attrs:{type:"text-primary"},on:{click:t.copyApi}},[t._v("克隆")]),t._v(" "),t.detailData.edit?e("gs-button",{attrs:{disabled:t.detailData.publish,title:t.detailData.publish?"如欲编辑，请先撤销发布该API":"",type:"text-primary"},on:{click:t.editApi}},[t._v("编辑")]):t._e(),t._v(" "),t.detailData.edit?e("gs-button",{attrs:{disabled:t.detailData.publish,title:t.detailData.publish?"如欲删除，请先撤销发布该API":"",type:"text-primary"},on:{click:t.deleteApi}},[t._v("删除")]):t._e()],1)]),t._v(" "),e("div",{staticClass:"api-extract-info"},[e("gs-tabs",{attrs:{type:"content-tab"},model:{value:t.activeTab,callback:function(a){t.activeTab=a},expression:"activeTab"}},[e("gs-tab-pane",{attrs:{label:"API信息",name:"info"}},[e("div",{staticClass:"info-body"},[e("div",{staticClass:"info-body-base"},[e("div",{staticClass:"info-body-base-title"},[t._v("基本信息")]),t._v(" "),e("div",{staticClass:"info-body-base-item"},[e("div",{staticClass:"info-item-left"},[e("div",{staticClass:"info-item-left-text"},[e("span",{staticClass:"info-label"},[t._v("API名称：")]),t._v(t._s(t.detailData.name||"-")+"\n                  ")]),t._v(" "),e("div",{staticClass:"info-item-left-text"},[e("span",{staticClass:"info-label"},[t._v("API分组：")]),t._v(t._s(t.detailData.groupName||"-")+"\n                  ")]),t._v(" "),e("div",{staticClass:"info-item-left-text"},[e("span",{staticClass:"info-label"},[t._v("版本：")]),t._v(t._s(t.detailData.version||"-")+"\n                  ")]),t._v(" "),e("div",{staticClass:"info-item-left-text"},[e("span",{staticClass:"info-label"},[t._v("描述：")]),t._v(t._s(t.detailData.description||"-")+"\n                  ")])]),t._v(" "),e("div",{staticClass:"info-item-right"},[e("div",{staticClass:"info-item-right-text"},[e("span",{staticClass:"info-label"},[t._v("协议类型：")]),t._v(t._s(t.detailData.protocol||"-")+"\n                  ")]),t._v(" "),e("div",{staticClass:"info-item-right-text"},[e("span",{staticClass:"info-label"},[t._v("请求方式：")]),t._v(t._s(t.detailData.requestMode||"-")+"\n                  ")]),t._v(" "),e("div",{staticClass:"info-item-right-text"},[e("span",{staticClass:"info-label"},[t._v("返回类型：")]),t._v(t._s(t.detailData.returnType||"-")+"\n                  ")]),t._v(" "),e("div",{staticClass:"info-item-right-text"},[e("span",{staticClass:"info-label"},[t._v("API路径：")]),t._v(t._s(t.detailData.path||"-")+"\n                  ")])])])]),t._v(" "),e("div",{staticClass:"info-body-data"},[e("div",{staticClass:"info-body-data-title"},[t._v("数据信息")]),t._v(" "),e("div",{staticClass:"info-body-data-item"},[e("div",{staticClass:"info-item-text"},[t._v("\n                  数据库："+t._s(t.detailData.dbName||"-")+"\n                ")]),t._v(" "),e("div",{staticClass:"info-item-text"},[t._v("\n                  数据表："+t._s(t.detailData.tableName||"-")+"\n                ")]),t._v(" "),e("div",{staticClass:"info-item-text"},[t._v("\n                  数据Owner："+t._s(t.dataOwners)+"\n                ")])]),t._v(" "),e("div",{staticClass:"info-body-data-table"},[e("el-table",{attrs:{data:t.apiTableData}},[e("el-table-column",{attrs:{type:"index",label:"序号"}}),t._v(" "),e("el-table-column",{attrs:{prop:"columnName",label:"名称"}}),t._v(" "),e("el-table-column",{attrs:{prop:"filter",label:"筛选字段"},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v("\n                      "+t._s(a.row.filter?"是":"否")+"\n                    ")]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"fill",label:"必传"},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v("\n                      "+t._s(a.row.fill?"是":"否")+"\n                    ")]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"defaultValue",label:"缺省值"}})],1)],1)])])]),t._v(" "),e("gs-tab-pane",{attrs:{label:"测试",name:"test"}},[e("div",{staticClass:"info-body"},[e("div",{staticClass:"req-msg"},[e("h5",{staticClass:"title"},[t._v("请求信息")]),t._v(" "),e("div",{staticClass:"request"},[t._l(t.testData,function(a,i){return e("div",{key:i,staticClass:"fields"},[e("gs-checkbox",{staticClass:"name",model:{value:a.check,callback:function(e){t.$set(a,"check",e)},expression:"item.check"}},[e("span",{attrs:{title:a.columnName}},[t._v(t._s(a.columnName))])]),t._v(" "),e("span",{staticClass:"value"},[e("fields-input",{attrs:{type:a.type},model:{value:a.value,callback:function(e){t.$set(a,"value",e)},expression:"item.value"}})],1)],1)}),t._v(" "),e("div",{staticClass:"fields"},[e("span",{staticClass:"name"},[t._v("limit")]),t._v(" "),e("span",{staticClass:"value"},[e("gs-input-number",{attrs:{precision:0},model:{value:t.limit,callback:function(a){t.limit=a},expression:"limit"}})],1)]),t._v(" "),e("div",{staticClass:"fields"},[e("span",{staticClass:"name"},[t._v("offset")]),t._v(" "),e("span",{staticClass:"value"},[e("gs-input-number",{attrs:{precision:0},model:{value:t.offset,callback:function(a){t.offset=a},expression:"offset"}})],1)]),t._v(" "),e("div",{staticClass:"gap"})],2),t._v(" "),e("div",{staticClass:"test-operation"},[e("gs-button",{attrs:{disabled:!t.btnLoading},on:{click:t.stopTest}},[t._v("停止测试")]),t._v(" "),e("gs-button",{attrs:{loading:t.btnLoading,type:"primary"},on:{click:t.startTest}},[t._v("开始测试")])],1)]),t._v(" "),e("div",{staticClass:"rep-res"},[e("h5",{staticClass:"title"},[t._v("返回数据")]),t._v(" "),e("div",{staticClass:"response"},[e("gs-tabs",{attrs:{type:"content-tab"},model:{value:t.activeName,callback:function(a){t.activeName=a},expression:"activeName"}},[e("gs-tab-pane",{attrs:{label:"编码模式",name:"json"}},[e("gs-textarea",{attrs:{value:t.testResStringify,autosize:{minRows:8,maxRows:12},readonly:""}})],1),t._v(" "),e("gs-tab-pane",{attrs:{label:"表格模式",name:"table"}},[e("el-table",{attrs:{data:t.testRes}},t._l(t.tableHeader,function(a,i){return e("el-table-column",{key:i,attrs:{label:a,prop:a},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                          "+t._s(e.row[a]+"")+"\n                        ")]}}],null,!0)})}),1)],1)],1)],1)])])])],1)],1)],1)])},staticRenderFns:[]};a.a=i},783:function(t,a,e){"use strict";var i=e(784),s=e(787);e.n(s);a.a=i.a},784:function(t,a,e){"use strict";var i=e(785),s=e(786),n=e(108)(i.a,s.a,null,null,null);a.a=n.exports},785:function(t,a,e){"use strict";a.a={name:"BreadCrumb",props:{currentLevel:{type:String,required:!0},upperLevel:{type:String,default:""},backPath:{type:String,default:""}},data:function(){return{}},computed:{isHideNav:function(){return!!this.$router.currentRoute.query.nav}},methods:{backBtnClick:function(){this.$emit("back")}}}},786:function(t,a,e){"use strict";var i={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return!t.upperLevel||t.isHideNav?e("div",{staticClass:"content-header-single"},[t._t("header",[t._v("\n    "+t._s(t.currentLevel)+"\n  ")])],2):e("div",{staticClass:"content-header-both"},[e("div",{staticClass:"back-link"},[e("router-link",{attrs:{to:t.backPath}},[e("gs-button",{staticClass:"back-btn",attrs:{type:"primary"},on:{click:t.backBtnClick}},[e("i",{staticClass:"gs-icon gs-icon-revoke"})])],1)],1),t._v(" "),e("div",{staticClass:"nav-name"},[e("div",{staticClass:"current-nav"},[t._v(t._s(t.currentLevel))]),t._v(" "),e("div",{staticClass:"upper-nav"},[t._v(t._s(t.upperLevel))])])])},staticRenderFns:[]};a.a=i},787:function(t,a){},837:function(t,a,e){"use strict";var i=e(846),s=e(847);var n=function(t){e(845)},l=e(108)(i.a,s.a,n,null,null);a.a=l.exports},845:function(t,a){},846:function(t,a,e){"use strict";var i=e(922),s=e.n(i),n=e(1),l=e.n(n),r=e(788);a.a={name:"FieldsInput",props:{value:{type:[String,Number,Object,Array,Boolean],default:""},disabled:{type:Boolean,default:!1},type:{type:String,default:""}},data:function(){return{numberType:r.b}},computed:{isNumber:function(){var t=this;return this.numberType.some(function(a){return t.type.startsWith(a)})},valueCache:function(){return"timestamp"===this.type&&""!==this.value?l()(this.value):this.value}},methods:{change:function(t){var a="";a="timestamp"===this.type?t.valueOf():this.isNumber&&s()(parseFloat(t))?parseFloat(t):t,this.$emit("input",a)}}}},847:function(t,a,e){"use strict";var i={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return"timestamp"===t.type?e("gs-date-picker",{attrs:{value:t.valueCache,disabled:t.disabled,type:"date-time"},on:{change:t.change}}):"boolean"===t.type?e("gs-radio-group",{attrs:{value:t.valueCache,disabled:t.disabled},on:{change:t.change}},[e("gs-radio",{attrs:{label:!0}}),t._v(" "),e("gs-radio",{attrs:{label:!1}})],1):e("gs-input",{staticClass:"fileds-input",attrs:{placeholder:t.isNumber?"请输入数字":"",value:t.valueCache,disabled:t.disabled},on:{change:t.change}})},staticRenderFns:[]};a.a=i},848:function(t,a,e){"use strict";var i=e(162),s=e.n(i),n=e(32),l=e.n(n),r=e(801),c=e(838),o=e.n(c),u=e(788),d=Math.random().toString(36).slice(-8);a.a={data:function(){return{testData:[],limit:10,offset:0,btnLoading:!1,activeName:"json",testRes:[],numberType:u.b}},computed:{tableHeader:function(){var t=this.testRes;return t&&t[0]?l()(t[0]):[]},testResStringify:function(){return s()(this.testRes,null,4)}},methods:{checkTestInput:function(){var t=this;if(""===this.offset||""===this.limit)return this.$Message.error("请填入limit和offset参数。"),!1;var a=this.testData.filter(function(t){return t.fill&&!t.check});if(a&&a.length){var e=a.map(function(t){return t.columnName}).join(",");return this.$Message.error(e+"字段为必填字段，请选中并输入数据"),!1}var i=this.testData.filter(function(t){return t.check}).filter(function(a){return!!(t.numberType.includes(a.type)&&""===a.value||"timestamp"===a.type&&""===a.value||"boolean"===a.type&&""===a.value)}).map(function(t){return t.columnName}).join(",");return!i||(this.$Message.error(i+"字段缺少过滤值内容，请输入"),!1)},stopTest:function(){var t=this;this.source.cancel(),r.stopTestApi(d).then(function(a){t.$Message.success("停止成功")})},startTest:function(){var t=this;if(this.checkTestInput()){var a=this.detailData,e={tableGuid:a.tableGuid,dbGuid:a.dbGuid,maxRowNumber:a.maxRowNumber,parameter:this.testData.filter(function(t){return t.check}).map(function(t){return"timestamp"===t.type&&t.value?{columnName:t.columnName,value:[t.value.unix()]}:{columnName:t.columnName,value:[t.value]}}),queryFields:this.detailData.fields.map(function(t){return t.columnName}),limit:this.limit,offset:this.offset};d=Math.random().toString(36).slice(-8),this.btnLoading=!0;var i=o.a.CancelToken;this.source=i.source(),r.testApi({params:e,randomName:d},this.source.token).then(function(a){t.testRes=a,t.btnLoading=!1}).catch(function(a){t.btnLoading=!1})}}}}}});
//# sourceMappingURL=18.6aa83bcf.js.map