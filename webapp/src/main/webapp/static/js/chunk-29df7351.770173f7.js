(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-29df7351"],{"0290":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return"timestamp"===t.type?n("gs-date-picker",{attrs:{value:t.valueCache,disabled:t.disabled,type:"date-time"},on:{change:t.change}}):"boolean"===t.type?n("gs-radio-group",{attrs:{value:t.valueCache,disabled:t.disabled},on:{change:t.change}},[n("gs-radio",{attrs:{label:!0}}),n("gs-radio",{attrs:{label:!1}})],1):n("gs-input",{staticClass:"fileds-input",attrs:{placeholder:t.isNumber?"请输入数字":"",value:t.valueCache,disabled:t.disabled},on:{change:t.change}})},i=[],s=(n("b1b1"),n("f559"),n("c5f6"),n("c1df")),o=n.n(s),r=n("ed08"),l={name:"FieldsInput",props:{value:{type:[String,Number,Object,Array,Boolean],default:""},disabled:{type:Boolean,default:!1},type:{type:String,default:""}},data:function(){return{numberType:r["b"]}},computed:{isNumber:function(){var t=this;return this.numberType.some(function(e){return t.type.startsWith(e)})},valueCache:function(){return"timestamp"===this.type&&""!==this.value?o()(this.value):this.value}},methods:{change:function(t){var e="";e="timestamp"===this.type?t.valueOf():this.isNumber&&Number.isSafeInteger(parseFloat(t))?parseFloat(t):t,this.$emit("input",e)}}},u=l,c=(n("43f5"),n("2877")),d=Object(c["a"])(u,a,i,!1,null,null,null);e["a"]=d.exports},"0a49":function(t,e,n){var a=n("9b43"),i=n("626a"),s=n("4bf8"),o=n("9def"),r=n("cd1c");t.exports=function(t,e){var n=1==t,l=2==t,u=3==t,c=4==t,d=6==t,f=5==t||d,m=e||r;return function(e,r,p){for(var h,g,b=s(e),v=i(b),y=a(r,p,3),k=o(v.length),x=0,N=n?m(e,k):l?m(e,0):void 0;k>x;x++)if((f||x in v)&&(h=v[x],g=y(h,x,b),t))if(n)N[x]=g;else if(g)switch(t){case 3:return!0;case 5:return h;case 6:return x;case 2:N.push(h)}else if(c)return!1;return d?-1:u||c?c:N}}},1169:function(t,e,n){var a=n("2d95");t.exports=Array.isArray||function(t){return"Array"==a(t)}},"20d6":function(t,e,n){"use strict";var a=n("5ca1"),i=n("0a49")(6),s="findIndex",o=!0;s in[]&&Array(1)[s](function(){o=!1}),a(a.P+a.F*o,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(s)},"28a5":function(t,e,n){"use strict";var a=n("aae3"),i=n("cb7c"),s=n("ebd6"),o=n("0390"),r=n("9def"),l=n("5f1b"),u=n("520a"),c=n("79e5"),d=Math.min,f=[].push,m="split",p="length",h="lastIndex",g=4294967295,b=!c(function(){RegExp(g,"y")});n("214f")("split",2,function(t,e,n,c){var v;return v="c"=="abbc"[m](/(b)*/)[1]||4!="test"[m](/(?:)/,-1)[p]||2!="ab"[m](/(?:ab)*/)[p]||4!="."[m](/(.?)(.?)/)[p]||"."[m](/()()/)[p]>1||""[m](/.?/)[p]?function(t,e){var i=String(this);if(void 0===t&&0===e)return[];if(!a(t))return n.call(i,t,e);var s,o,r,l=[],c=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),d=0,m=void 0===e?g:e>>>0,b=new RegExp(t.source,c+"g");while(s=u.call(b,i)){if(o=b[h],o>d&&(l.push(i.slice(d,s.index)),s[p]>1&&s.index<i[p]&&f.apply(l,s.slice(1)),r=s[0][p],d=o,l[p]>=m))break;b[h]===s.index&&b[h]++}return d===i[p]?!r&&b.test("")||l.push(""):l.push(i.slice(d)),l[p]>m?l.slice(0,m):l}:"0"[m](void 0,0)[p]?function(t,e){return void 0===t&&0===e?[]:n.call(this,t,e)}:n,[function(n,a){var i=t(this),s=void 0==n?void 0:n[e];return void 0!==s?s.call(n,i,a):v.call(String(i),n,a)},function(t,e){var a=c(v,t,this,e,v!==n);if(a.done)return a.value;var u=i(t),f=String(this),m=s(u,RegExp),p=u.unicode,h=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(b?"y":"g"),y=new m(b?u:"^(?:"+u.source+")",h),k=void 0===e?g:e>>>0;if(0===k)return[];if(0===f.length)return null===l(y,f)?[f]:[];var x=0,N=0,C=[];while(N<f.length){y.lastIndex=b?N:0;var _,A=l(y,b?f:f.slice(N));if(null===A||(_=d(r(y.lastIndex+(b?0:N)),f.length))===x)N=o(f,N,p);else{if(C.push(f.slice(x,N)),C.length===k)return C;for(var w=1;w<=A.length-1;w++)if(C.push(A[w]),C.length===k)return C;N=x=_}}return C.push(f.slice(x)),C}]})},3598:function(t,e,n){},"36bd":function(t,e,n){"use strict";var a=n("4bf8"),i=n("77f1"),s=n("9def");t.exports=function(t){var e=a(this),n=s(e.length),o=arguments.length,r=i(o>1?arguments[1]:void 0,n),l=o>2?arguments[2]:void 0,u=void 0===l?n:i(l,n);while(u>r)e[r++]=t;return e}},3846:function(t,e,n){n("9e1e")&&"g"!=/./g.flags&&n("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:n("0bfb")})},"43f5":function(t,e,n){"use strict";var a=n("e932"),i=n.n(a);i.a},6853:function(t,e,n){"use strict";n("6762"),n("2fdb"),n("6c7b"),n("ac6a"),n("456d"),n("6b54");var a=n("f63f"),i=n("bc3a"),s=n.n(i),o=n("ed08"),r=Math.random().toString(36).slice(-8);e["a"]={data:function(){return{testData:[],limit:10,offset:0,btnLoading:!1,activeName:"json",testRes:[],numberType:o["b"]}},computed:{tableHeader:function(){var t=this.testRes;return t&&t[0]?Object.keys(t[0]):[]},testResStringify:function(){return JSON.stringify(this.testRes,null,4)}},methods:{checkTestInput:function(){var t=this;if(""===this.offset||""===this.limit)return this.$Message.error("请填入limit和offset参数。"),!1;var e=this.testData.filter(function(t){return t.fill&&!t.check});if(e&&e.length){var n=e.map(function(t){return t.columnName}).join(",");return this.$Message.error("".concat(n,"字段为必填字段，请选中并输入数据")),!1}var a=this.testData.filter(function(t){return t.check}).filter(function(e){return!!(t.numberType.includes(e.type)&&""===e.value||"timestamp"===e.type&&""===e.value||"boolean"===e.type&&""===e.value)}).map(function(t){return t.columnName}).join(",");return!a||(this.$Message.error("".concat(a,"字段缺少过滤值内容，请输入")),!1)},stopTest:function(){var t=this;this.source.cancel(),a["stopTestApi"](r).then(function(e){t.$Message.success("停止成功")})},startTest:function(){var t=this;if(this.checkTestInput()){var e=this.detailData,n=e.tableGuid,i=e.dbGuid,o=e.maxRowNumber,l=this.testData.filter(function(t){return t.check}).map(function(t){return"timestamp"===t.type&&t.value?{columnName:t.columnName,value:[t.value.unix()]}:{columnName:t.columnName,value:[t.value]}}),u=this.detailData.fields.map(function(t){return t.columnName}),c={tableGuid:n,dbGuid:i,maxRowNumber:o,parameter:l,queryFields:u,limit:this.limit,offset:this.offset};r=Math.random().toString(36).slice(-8),this.btnLoading=!0;var d=s.a.CancelToken;this.source=d.source(),a["testApi"]({params:c,randomName:r},this.source.token).then(function(e){t.testRes=e,t.btnLoading=!1,t.$Message.success("测试完成！")}).catch(function(e){t.btnLoading=!1,console.log("Request canceled",e.message)})}}}}},"6b54":function(t,e,n){"use strict";n("3846");var a=n("cb7c"),i=n("0bfb"),s=n("9e1e"),o="toString",r=/./[o],l=function(t){n("2aba")(RegExp.prototype,o,t,!0)};n("79e5")(function(){return"/a/b"!=r.call({source:"a",flags:"b"})})?l(function(){var t=a(this);return"/".concat(t.source,"/","flags"in t?t.flags:!s&&t instanceof RegExp?i.call(t):void 0)}):r.name!=o&&l(function(){return r.call(this)})},"6c7b":function(t,e,n){var a=n("5ca1");a(a.P,"Array",{fill:n("36bd")}),n("9c6c")("fill")},7514:function(t,e,n){"use strict";var a=n("5ca1"),i=n("0a49")(5),s="find",o=!0;s in[]&&Array(1)[s](function(){o=!1}),a(a.P+a.F*o,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(s)},"9c12":function(t,e,n){var a=n("d3f4"),i=Math.floor;t.exports=function(t){return!a(t)&&isFinite(t)&&i(t)===t}},b1b1:function(t,e,n){var a=n("5ca1"),i=n("9c12"),s=Math.abs;a(a.S,"Number",{isSafeInteger:function(t){return i(t)&&s(t)<=9007199254740991}})},cb52:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"create-api"},[n("gs-button",{staticClass:"revoke",attrs:{type:"primary",icon:"revoke"},on:{click:t.returnList}}),n("gs-steps",{attrs:{active:t.activeStep,"align-center":"",space:"160px",size:"small"}},[n("template",{slot:"header"},t._l(t.stepsTitle,function(t,e){return n("gs-step",{key:e,attrs:{title:t}})}),1),n("template",{slot:"content"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"steps-content"},[n("transition",{attrs:{name:"fade-transform-right",mode:"out-in"}},[n("keep-alive",[t.hasData?n(t.component,{tag:"component",attrs:{"is-edit":t.isEdit,data:t.apiData,"active-step":t.activeStep},on:{next:t.handleNext,back:t.handlePrev}}):t._e()],1)],1)],1)])],2)],1)},i=[],s=(n("3598"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"data-source"},[n("gs-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-position":"top"}},[n("gs-form-item",{attrs:{label:"数据库",prop:"dbGuid"}},[n("gs-select",{attrs:{disabled:t.columnLoading||t.tableLoading,searchable:""},on:{change:t.dbSelectChange},model:{value:t.form.dbGuid,callback:function(e){t.$set(t.form,"dbGuid",e)},expression:"form.dbGuid"}},t._l(t.databaseOptions,function(t){return n("gs-option",{key:t.databaseId,attrs:{label:t.databaseName,value:t.databaseId}})}),1)],1),n("gs-form-item",{attrs:{label:"数据表",prop:"tableGuid"}},[n("gs-select",{attrs:{disabled:t.columnLoading,searchable:""},on:{"visible-change":t.tableSelectVisibleChange},model:{value:t.form.tableGuid,callback:function(e){t.$set(t.form,"tableGuid",e)},expression:"form.tableGuid"}},t._l(t.tableOptions,function(t){return n("gs-option",{key:t.tableGuid,attrs:{label:t.displayName+"（"+t.tableName+"）",value:t.tableGuid}})}),1)],1),n("gs-form-item",{attrs:{label:"最大结果行数",prop:"maxRowNumber"}},[n("gs-input-number",{attrs:{min:1,max:2e3},model:{value:t.form.maxRowNumber,callback:function(e){t.$set(t.form,"maxRowNumber",e)},expression:"form.maxRowNumber"}})],1),n("gs-form-item",{attrs:{label:"字段",prop:"column"}},[n("div",{staticClass:"column"},[n("gs-modal-select",{attrs:{loading:t.columnLoading,"right-selected-render":t.rightSelectedRender,flatten:""},on:{change:t.handleCheckedColumnChange},model:{value:t.form.column,callback:function(e){t.$set(t.form,"column",e)},expression:"form.column"}},t._l(t.columnOptions,function(t){return n("gs-option",{key:t.columnId,attrs:{label:t.displayName+"（"+t.columnName+"）",value:t.columnName,desc:t.columnId}})}),1),n("div",{staticClass:"line"}),n("div",{staticClass:"desc-label"},[t._v("\n          描述\n        ")])],1)])],1),n("div",{directives:[{name:"show",rawName:"v-show",value:t.columnOptions&&t.columnOptions.length,expression:"columnOptions && columnOptions.length"}],staticClass:"choose-all-fileds"},[n("gs-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("\n      全选\n    ")])],1),n("div",{staticClass:"operation"},[n("gs-button",{attrs:{type:"primary"},on:{click:t.handleNext}},[t._v("\n      下一步\n    ")])],1)],1)}),o=[],r=(n("6762"),n("2fdb"),n("db72")),l=(n("20d6"),n("7514"),n("ac6a"),n("456d"),n("2f62")),u={computed:Object(r["a"])({},Object(l["c"])("datashare",["storeApiMsg"])),methods:Object(r["a"])({},Object(l["b"])("datashare",["saveApiMsg"]))},c=n("f63f"),d={mixins:[u],props:{data:{type:Object,default:function(){return{}}}},data:function(){var t=function(t,e,n){""===e&&n(new Error("请填写最大结果行数")),e&&/\d/.test(e)?n():n(new Error("最大结果行数必须为数字且不能为0"))};return{form:{dbGuid:"",tableGuid:"",column:[],maxRowNumber:10},loading:!1,tableOptions:[],databaseOptions:[],columnOptions:[],columnLoading:!1,tableLoading:!1,rules:{dbGuid:[{required:!0,trigger:"change",message:"请选择数据库"}],tableGuid:[{required:!0,trigger:"change",message:"请选择数据表"}],column:[{required:!0,trigger:"change",message:"请选择字段",type:"array"}],maxRowNumber:[{required:!0,trigger:"blur",validator:t}]},isIndeterminate:!1,checkAll:!1}},watch:{"form.tableGuid":{handler:function(t){var e=this;t&&(this.form.column=[],this.$nextTick(function(t){e.$refs.form.clearValidate("column")}),this.fetchColumn())}}},created:function(){var t=this;this.fetchDatabase().then(function(e){t.data&&Object.keys(t.data).length&&t.setData()})},methods:{setData:function(){var t=this,e=this.data,n=e.dbGuid,a=e.tableGuid,i=e.maxRowNumber,s=e.fields,o=s.map(function(t){return t.columnName});this.form={dbGuid:n,tableGuid:a,maxRowNumber:i,column:[]},this.$nextTick(function(e){t.$refs.form.clearValidate("column")});var r=this.databaseOptions.find(function(e){return e.databaseId===t.form.dbGuid});r||(this.form.dbGuid="",this.form.tableGuid="",this.$Message.warning("无该库权限")),this.tableSelectVisibleChange(!0),r&&this.fetchColumn().then(function(e){t.$nextTick(function(e){t.form.column=o})})},fetchDatabase:function(){var t=this;return this.loading=!0,c["getDataBase"]({offset:0,limit:-1,query:""}).then(function(e){t.databaseOptions=e.lists,t.loading=!1})},fetchTable:function(){var t=this;return this.tableLoading=!0,c["getTable"]({dbGuid:this.form.dbGuid,offset:0,limit:-1,query:""}).then(function(e){t.tableOptions=e.lists,t.tableLoading=!1;var n=t.tableOptions.find(function(e){return e.tableGuid===t.form.tableGuid});n||(t.form.tableGuid="")})},fetchColumn:function(){var t=this;return this.columnLoading=!0,c["getColumn"](this.form.tableGuid).then(function(e){return t.columnOptions=e,t.columnLoading=!1,e})},tableSelectVisibleChange:function(t){t&&(this.form.dbGuid?(this.fetchTable(),this.handleCheckedColumnChange([])):this.$refs.form.validateField("dbGuid"))},rightSelectedRender:function(t,e){var n=this.columnOptions.find(function(t){return e.value===t.columnName});return t("div",[t("span",{class:"label",attrs:{title:n.columnName}},[n.columnName]),t("span",{class:"desc",attrs:{title:n.description}},[n.description||"-"]),t("i",{class:"gs-icon-close",on:{click:this.unselectOption.bind(this,e)}})])},unselectOption:function(t){var e=this.form.column.findIndex(function(e){return e===t.value});this.form.column.splice(e,1)},handleNext:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.saveApiMsg(Object(r["a"])({},t.form,{column:t.columnOptions.filter(function(e){return t.form.column.includes(e.columnName)})})),t.$emit("next"))})},dbSelectChange:function(){this.form.tableGuid="",this.form.column=[],this.columnOptions=[]},handleCheckAllChange:function(t){this.form.column=t.target.checked?this.columnOptions.map(function(t){return t.columnName}):[],this.isIndeterminate=!1},handleCheckedColumnChange:function(t){var e=t.length;this.checkAll=e>0,this.isIndeterminate=e>0&&e<this.columnOptions.length}}},f=d,m=n("2877"),p=Object(m["a"])(f,s,o,!1,null,null,null),h=p.exports,g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"base-info"},[n("gs-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-position":"top"}},[n("gs-form-item",{attrs:{label:"API名称",prop:"name"}},[n("gs-input",{attrs:{placeholder:"请填写API名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),n("gs-form-item",{attrs:{label:"API分组",prop:"groupGuid"}},[n("gs-select",{attrs:{placeholder:"请选择API分组",searchable:""},model:{value:t.form.groupGuid,callback:function(e){t.$set(t.form,"groupGuid",e)},expression:"form.groupGuid"}},t._l(t.groupOptions,function(t){return n("gs-option",{key:t.guid,attrs:{label:t.name,value:t.guid}})}),1)],1),n("gs-form-item",{attrs:{label:"版本",prop:"version"}},[n("gs-input-number",{attrs:{min:0,placeholder:"请填写API版本"},model:{value:t.form.version,callback:function(e){t.$set(t.form,"version",e)},expression:"form.version"}})],1),n("gs-form-item",{attrs:{label:"描述",prop:"description"}},[n("gs-textarea",{attrs:{placeholder:"请填写描述信息"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),n("div",{staticClass:"info"},[n("div",[n("span",[t._v("协议类型")]),n("span",[t._v(t._s(t.form.protocol))])]),n("div",[n("span",[t._v("请求方式")]),n("span",[t._v(t._s(t.form.requestMode))])]),n("div",[n("span",[t._v("返回类型")]),n("span",[t._v(t._s(t.form.returnType))])]),n("div",[n("span",[t._v("API路径")]),n("span",[t._v(t._s(t.form.path))])])]),n("div",{staticClass:"operation"},[n("gs-button",{on:{click:t.handleBack}},[t._v("\n      上一步\n    ")]),n("gs-button",{attrs:{type:"primary"},on:{click:t.handleNext}},[t._v("\n      下一步\n    ")])],1)],1)},b=[],v=(n("c5f6"),n("7f7f"),n("28a5"),n("6b54"),{mixins:[u],props:{data:{type:Object,default:function(){return{}}}},data:function(){return{form:{name:"",groupGuid:"",version:1,description:"",path:"",returnType:"JSON | XML",protocol:"HTTP",requestMode:"POST"},getRandString:(new Date).getTime().toString(36),rules:{name:[{required:!0,trigger:"blur",message:"请填写API名称"}],groupGuid:[{required:!0,trigger:"change",message:"请选择API分组"}],version:[{validator:function(t,e,n){console.log(e),e||0===e?e>1e4?n(new Error("API版本不能大于 10000 ！")):n():n(new Error("请填写API版本"))}}]}}},computed:Object(r["a"])({},Object(l["c"])("datashare",["sourceGroupTree"]),{groupOptions:{set:function(t){return t},get:function(){return this.sourceGroupTree.length?this.sourceGroupTree.filter(function(t){return t.parentGuid}):[]}}}),watch:{"form.version":{handler:function(t){if(this.$route.query.isEdit){var e=this.data.path.split("/").reverse()[0];this.form.path="/api/v"+t+"/share/"+e}else this.form.path="/api/v"+t+"/share/"+this.getRandString},immediate:!0}},created:function(){this.fetchGroupList(),this.data&&Object.keys(this.data).length&&this.setData()},methods:{setData:function(){var t=this.data,e=t.name,n=t.groupGuid,a=t.protocol,i=t.requestMode,s=t.returnType,o=t.version,l=t.description;this.form=Object(r["a"])({},this.form,{name:this.$route.query.isEdit?e:"",groupGuid:n,version:Number(o),description:l,returnType:s,protocol:a,requestMode:i})},fetchGroupList:function(){var t=this;this.loading=!0,this.sourceGroupTree&&this.sourceGroupTree.length?(this.groupOptions=this.sourceGroupTree.filter(function(t){return t.parentGuid}),this.loading=!1):c["getGroupList"]().then(function(e){t.groupOptions=e.filter(function(t){return t.parentGuid}),t.loading=!1})},handleBack:function(){this.$emit("back")},handleNext:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.data&&Object.keys(t.data).length&&t.form.name===t.data.name&&t.$route.query.isEdit?(t.saveApiMsg(t.form),t.$emit("next")):c["checkName"]({name:t.form.name}).then(function(e){e?t.$Message.error("已存在该名称"):(t.saveApiMsg(t.form),t.$emit("next"))}))})}}}),y=v,k=Object(m["a"])(y,g,b,!1,null,null,null),x=k.exports,N=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"api-config"},[n("div",{staticClass:"content"},[n("div",{staticClass:"all-fileds"},[n("div",{staticClass:"all-fileds-header"},[n("h4",{staticClass:"title"},[t._v("\n          已选字段\n        ")]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.storeApiMsg.column&&t.storeApiMsg.column.length,expression:"storeApiMsg.column && storeApiMsg.column.length"}],staticClass:"choose-all-fileds"},[n("gs-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("\n            全选\n          ")])],1)]),n("ul",{staticClass:"container"},t._l(t.storeApiMsg.column||[],function(e,a){return n("li",{key:a,class:t.fieldsName.includes(e.columnName)?"active":"",on:{click:function(n){return t.chooseFields(e)}}},[t.fieldsName.includes(e.columnName)?n("i",{staticClass:"gs-icon-check"}):t._e(),n("span",[t._v(t._s(e.columnName))]),n("i",{staticClass:"gs-icon-close",on:{click:function(n){return n.stopPropagation(),t.deleteField(e.columnName,a)}}})])}),0)]),n("div",{staticClass:"filter-fileds"},[n("h4",{staticClass:"title"},[t._v("\n        过滤条件字段\n      ")]),n("div",{staticClass:"container"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.fields}},[n("el-table-column",{attrs:{prop:"columnName",label:"名称","show-overflow-tooltip":""}}),n("el-table-column",{attrs:{prop:"fill",label:"必传","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(e.row.fill?"是":"否"))])]}}])}),n("el-table-column",{attrs:{prop:"type",label:"类型","show-overflow-tooltip":""}}),n("el-table-column",{attrs:{prop:"defaultValue",label:"默认值","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(e.row.defaultValue||"无"))])]}}])}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",[n("gs-button",{attrs:{type:"text-primary"},on:{click:function(n){return t.editFilterField(e)}}},[t._v("\n                  编辑\n                ")]),n("gs-button",{attrs:{type:"text-primary"},on:{click:function(n){return t.deleteField(e.row.columnName)}}},[t._v("\n                  删除\n                ")])],1)]}}])})],1)],1)])]),n("div",{staticClass:"operation"},[n("gs-button",{on:{click:t.handleBack}},[t._v("\n      上一步\n    ")]),n("gs-button",{attrs:{type:"primary"},on:{click:t.handleNext}},[t._v("\n      下一步\n    ")])],1),n("add-default-value",{attrs:{show:t.modalVisible,data:t.form},on:{"update:show":function(e){t.modalVisible=e},confirm:t.confirmEditField}})],1)},C=[],_=n("75fc"),A=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("gs-modal",{attrs:{title:"过滤条件字段"},on:{confirm:t.confirmEditField,cancel:t.cancel},model:{value:t.modalVisible,callback:function(e){t.modalVisible=e},expression:"modalVisible"}},[n("gs-form",{attrs:{model:t.form,"label-width":"120px"}},[n("gs-form-item",{attrs:{label:"字段名称",prop:"columnName"}},[n("span",[t._v(t._s(t.form.columnName))])]),n("gs-form-item",{attrs:{label:"字段类型",prop:"type"}},[n("span",[t._v(t._s(t.form.type))])]),n("gs-form-item",{attrs:{label:"必传",prop:"fill"}},[n("gs-radio-group",{model:{value:t.form.fill,callback:function(e){t.$set(t.form,"fill",e)},expression:"form.fill"}},[n("gs-radio",{attrs:{label:!0}},[t._v("\n          是\n        ")]),n("gs-radio",{attrs:{label:!1}},[t._v("\n          否\n        ")])],1)],1),t.form.fill?t._e():n("gs-form-item",{attrs:{label:"是否有缺省默认值",prop:"useDefaultValue"}},[n("gs-radio-group",{on:{change:t.useDefaultValueChange},model:{value:t.form.useDefaultValue,callback:function(e){t.$set(t.form,"useDefaultValue",e)},expression:"form.useDefaultValue"}},[n("gs-radio",{attrs:{label:!0}},[t._v("\n          是\n        ")]),n("gs-radio",{attrs:{label:!1}},[t._v("\n          否\n        ")])],1)],1),t.form.fill?t._e():n("gs-form-item",{attrs:{label:"默认值",prop:"defaultValue"}},[n("fields-input",{attrs:{type:t.form.type,disabled:!t.form.useDefaultValue},model:{value:t.form.defaultValue,callback:function(e){t.$set(t.form,"defaultValue",e)},expression:"form.defaultValue"}})],1)],1)],1)},w=[],$=n("0290"),O={components:{fieldsInput:$["a"]},props:{show:{type:Boolean,default:!1},data:{type:Object,default:function(){}}},data:function(){return{modalVisible:!1,form:{}}},watch:{data:function(t){this.form=t},show:function(t){this.modalVisible=t}},methods:{confirmEditField:function(){this.$emit("confirm",this.form)},cancel:function(){this.$emit("update:show",!1)},useDefaultValueChange:function(t){t||(this.form.defaultValue="")}}},G=O,I=Object(m["a"])(G,A,w,!1,null,null,null),S=I.exports,M={components:{addDefaultValue:S},mixins:[u],props:{data:{type:Object,default:function(){return{}}}},data:function(){return{fields:[],form:{},modalVisible:!1,editIndex:-1,isIndeterminate:!1,checkAll:!1}},computed:{fieldsName:function(){return this.fields.map(function(t){return t.columnName})}},watch:{"storeApiMsg.column":{handler:function(t,e){var n=JSON.stringify(t)===JSON.stringify(e);n||(this.fields=[],this.changeCheckAllStatus())},deep:!0}},created:function(){this.data&&Object.keys(this.data).length&&this.setData()},methods:{setData:function(){var t=this.storeApiMsg.column.map(function(t){return t.columnName});this.fields=(this.data.fields||[]).filter(function(e){return e.filter&&t.includes(e.columnName)}),this.changeCheckAllStatus()},handleNext:function(){var t=this,e=[];this.storeApiMsg.column.map(function(n){t.fieldsName.includes(n.columnName)||e.push({columnName:n.columnName,filter:!1,type:n.type})}),this.saveApiMsg({fields:[].concat(e,Object(_["a"])(this.fields))}),this.$emit("next")},handleBack:function(){this.$emit("back")},chooseFields:function(t){this.fieldsName.includes(t.columnName)||(this.fields.push({columnName:t.columnName,filter:!0,fill:!1,defaultValue:"",type:t.type,useDefaultValue:!1}),this.changeCheckAllStatus())},deleteField:function(t,e){var n=this.fields.findIndex(function(e){return t===e.columnName});-1!==n&&(this.fields.splice(n,1),this.changeCheckAllStatus())},editFilterField:function(t){this.modalVisible=!0,this.form=JSON.parse(JSON.stringify(t.row)),this.editIndex=t.$index},confirmEditField:function(t){this.$set(this.fields,this.editIndex,t),this.modalVisible=!1},handleCheckAllChange:function(t){this.fields=t.target.checked?this.storeApiMsg.column.map(function(t){return{columnName:t.columnName,filter:!0,fill:!1,defaultValue:"",type:t.type,useDefaultValue:!1}}):[],this.isIndeterminate=!1},changeCheckAllStatus:function(){var t=this.fields.length;this.checkAll=t>0,this.isIndeterminate=t>0&&t<this.storeApiMsg.column.length}}},D=M,T=Object(m["a"])(D,N,C,!1,null,null,null),V=T.exports,R=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"test-api"},[n("div",{staticClass:"content"},[n("p",{staticClass:"title"},[n("span",[t._v("API地址")]),n("span",{staticClass:"path"},[t._v(t._s(t.storeApiMsg.path))])]),n("div",{staticClass:"req-msg"},[n("h5",{staticClass:"title"},[t._v("\n        请求信息\n      ")]),n("div",{staticClass:"request"},[t._l(t.testData,function(e,a){return n("div",{key:a,staticClass:"fields"},[n("gs-checkbox",{staticClass:"name",model:{value:e.check,callback:function(n){t.$set(e,"check",n)},expression:"item.check"}},[n("span",{attrs:{title:e.columnName}},[t._v(t._s(e.columnName))])]),n("span",[t._v("=")]),n("span",{staticClass:"value"},[n("fields-input",{attrs:{type:e.type},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"item.value"}})],1)],1)}),n("div",{staticClass:"fields"},[n("span",{staticClass:"name"},[t._v("limit")]),n("span",[t._v("=")]),n("span",{staticClass:"value"},[n("gs-input-number",{attrs:{precision:0,min:0,max:100},model:{value:t.limit,callback:function(e){t.limit=e},expression:"limit"}})],1)]),n("div",{staticClass:"fields"},[n("span",{staticClass:"name"},[t._v("offset")]),n("span",[t._v("=")]),n("span",{staticClass:"value"},[n("gs-input-number",{attrs:{precision:0,min:0},model:{value:t.offset,callback:function(e){t.offset=e},expression:"offset"}})],1)])],2),n("div",{staticClass:"test-operation"},[n("gs-button",{attrs:{disabled:!t.btnLoading},on:{click:t.stopTest}},[t._v("\n          停止测试\n        ")]),n("gs-button",{attrs:{loading:t.btnLoading,type:"primary"},on:{click:t.startTest}},[t._v("\n          开始测试\n        ")])],1)]),n("div",{staticClass:"rep-res"},[n("div",{staticClass:"response"},[n("gs-tabs",{attrs:{type:"content-tab"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[n("gs-tab-pane",{attrs:{label:"编码模式",name:"json"}},[n("gs-textarea",{attrs:{value:t.testResStringify,autosize:{minRows:8,maxRows:12},readonly:""}})],1),n("gs-tab-pane",{attrs:{label:"表格模式",name:"table"}},[n("el-table",{attrs:{data:t.testRes}},t._l(t.tableHeader,function(e,a){return n("el-table-column",{key:a,attrs:{label:e,prop:e},scopedSlots:t._u([{key:"default",fn:function(n){return[t._v("\n                  "+t._s(n.row[e]+"")+"\n                ")]}}],null,!0)})}),1)],1)],1)],1)])]),n("div",{staticClass:"operation"},[n("gs-button",{on:{click:t.handleBack}},[t._v("\n      上一步\n    ")]),n("gs-button",{attrs:{type:"primary"},on:{click:t.handleNext}},[t._v("\n      完成\n    ")])],1)])},q=[],j=(n("6c7b"),n("6853")),E=n("bc3a"),L=n.n(E),F=Math.random().toString(36).slice(-8),P={components:{fieldsInput:$["a"]},mixins:[u,j["a"]],data:function(){return{}},computed:{},activated:function(){var t=this;this.testData=(this.storeApiMsg.fields||[]).filter(function(t){return t.filter}).map(function(e){var n=(t.storeApiMsg.column||[]).find(function(t){return t.columnName===e.columnName});return{columnName:e.columnName,value:e.defaultValue||"",check:!0,type:n.type,fill:e.fill}})},methods:{handleNext:function(){this.$emit("next")},handleBack:function(){this.$emit("back")},startTest:function(){var t=this;if(this.checkTestInput()){var e=this.storeApiMsg,n=e.tableGuid,a=e.dbGuid,i=e.maxRowNumber,s=this.testData.filter(function(e){var n=(t.storeApiMsg.fields||[]).find(function(t){return t.columnName===e.columnName});return e.check||!e.fill&&""!==n.defaultValue}).map(function(t){return{columnName:t.columnName,value:[t.value]}}),o=this.storeApiMsg.column.map(function(t){return t.columnName}),r={tableGuid:n,dbGuid:a,maxRowNumber:i,parameter:s,queryFields:o,limit:this.limit,offset:this.offset};F=Math.random().toString(36).slice(-8),this.btnLoading=!0;var l=L.a.CancelToken;this.source=l.source(),c["testApi"]({params:r,randomName:F},this.source.token).then(function(e){t.testRes=e,t.btnLoading=!1,t.$Message.success("测试完成！")}).catch(function(e){t.btnLoading=!1,console.log("Request canceled",e.message)})}}}},B=P,J=Object(m["a"])(B,R,q,!1,null,null,null),H=J.exports,z=["选择数据源","基本信息","API配置信息","测试"],W={components:{dataSource:h,baseInfo:x,apiConfig:V,apiTest:H},mixins:[u],data:function(){return{activeStep:0,stepsTitle:z,components:["dataSource","baseInfo","apiConfig","apiTest"],isEdit:!1,apiData:null,allDone:!1,loading:!1}},computed:{component:function(){return this.components[this.activeStep]},hasData:function(){return!this.$route.query.apiId||null!==this.apiData}},created:function(){this.fetchApiDetail()},methods:{handleNext:function(){var t=this;if(this.activeStep<3)this.activeStep=this.activeStep+1;else{var e=JSON.parse(JSON.stringify(this.storeApiMsg));delete e.column;var n=this.$route.query,a=n.isEdit,i=n.apiId;this.loading=!0,a&&i?c["editApi"]({params:e,apiId:i}).then(function(e){t.$Message.success("修改成功"),t.allDone=!0,t.loading=!1,t.$router.push({name:"/main/data-share",query:{groupId:t.$route.query.groupId}})}).catch(function(e){t.loading=!1}):c["createApi"](e).then(function(e){t.allDone=!0,t.loading=!1,t.$Message.success("创建成功"),t.$router.push({name:"/main/data-share",query:{groupId:t.$route.query.groupId}})}).catch(function(e){t.loading=!1})}},handlePrev:function(){this.activeStep=this.activeStep-1},fetchApiDetail:function(){var t=this;this.$route.query.apiId&&c["getApiDetail"](this.$route.query.apiId).then(function(e){t.apiData=e})},returnList:function(){this.$router.push({path:"/main/data-share/list",query:{groupId:this.$route.query.groupId}})}}},X=W,K=Object(m["a"])(X,a,i,!1,null,null,null);e["default"]=K.exports},cd1c:function(t,e,n){var a=n("e853");t.exports=function(t,e){return new(a(t))(e)}},e853:function(t,e,n){var a=n("d3f4"),i=n("1169"),s=n("2b4c")("species");t.exports=function(t){var e;return i(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!i(e.prototype)||(e=void 0),a(e)&&(e=e[s],null===e&&(e=void 0))),void 0===e?Array:e}},e932:function(t,e,n){}}]);
//# sourceMappingURL=chunk-29df7351.770173f7.js.map